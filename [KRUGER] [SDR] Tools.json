{
  "name": "[KRUGER] [SDR] Tools",
  "nodes": [
    {
      "parameters": {
        "content": "# VERIFICA DISPONIBILIDADE\n",
        "height": 383,
        "width": 2696,
        "color": 2
      },
      "id": "a945f025-3da8-47ce-bca8-a3bb76695216",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4512,
        -2080
      ]
    },
    {
      "parameters": {
        "content": "# AGENDA HOR√ÅRIO",
        "height": 564,
        "width": 2385,
        "color": 6
      },
      "id": "8e49450e-3bf0-4dbb-8bbe-5f4283c03d66",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4512,
        -1664
      ]
    },
    {
      "parameters": {
        "content": "#              LOUVADO SEJA DEUS",
        "height": 80,
        "width": 432,
        "color": 6
      },
      "id": "8eaf03ed-a9a7-46ee-80f9-284ff4bfcfbd",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5008,
        -1760
      ]
    },
    {
      "parameters": {
        "content": "# CLIENTE:\n## KRUGER",
        "height": 129.19985194312736,
        "width": 391.9230134079477,
        "color": 4
      },
      "id": "9ca97a7b-ab20-4345-8f6a-883e4cc8b98a",
      "name": "Sticky Note16",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5008,
        -1952
      ]
    },
    {
      "parameters": {
        "content": "# Ferramentas e fluxos para SDR",
        "height": 1534,
        "width": 3310,
        "color": 7
      },
      "id": "4ec612df-2e78-46b7-9377-cef454e6fb14",
      "name": "Sticky Note23",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5040,
        -2208
      ]
    },
    {
      "parameters": {
        "content": "## Tools do flowise para calend√°rio",
        "height": 88.34199434989154,
        "width": 355.25753985841834
      },
      "id": "8ea0da94-c60a-44dd-9e5e-ec0a4d055e68",
      "name": "Sticky Note24",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5008,
        -2080
      ]
    },
    {
      "parameters": {
        "content": "# CALEND√ÅRIO",
        "height": 115,
        "width": 625,
        "color": 5
      },
      "id": "ae372293-cde0-41aa-93f6-53d6dbbde948",
      "name": "Sticky Note25",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -5040,
        -2352
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sdrtoolcriareventokruger",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "ee071868-dbbb-4bfc-8785-e998d49780d6",
      "name": "criar evento",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4432,
        -1536
      ],
      "webhookId": "ace9234e-1844-4f6e-a0e3-a59ea40e98ba"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "490aba053d46ca104b5c75535829ac9039489d637fba39d713dc84a12c8a00bc@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "KRUGER Atendimento IA "
        },
        "start": "={{ $('formata horarios').first().json.start }}",
        "end": "={{ $('formata horarios').first().json.end }}",
        "additionalFields": {
          "attendees": [
            "={{ $('campos evento').first().json.Email }}"
          ],
          "description": "=Wpp: {{ $('campos evento').first().json.SessionID }}",
          "summary": "IA | AGENDAMENTO"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        -4128,
        -1312
      ],
      "id": "f6022bc9-78f6-4c32-abcd-278005081aa9",
      "name": "criar evento calendar",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "SiBx2sbnugOWgOZH",
          "name": "[KRUGER] Calendar"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9d964e01-5588-474a-980d-ba281028d471",
              "name": "SessionID",
              "value": "={{ $('criar evento').first().json.body.SessionID }}",
              "type": "string"
            },
            {
              "id": "dc156bc0-d53c-4c40-be51-be6049efa452",
              "name": "Instancia",
              "value": "={{ $('criar evento').first().json.body.Instancia }}",
              "type": "string"
            },
            {
              "id": "35f2c662-9a8b-4a9d-bbf0-dfe1688b43ce",
              "name": "horario_confirmado_iso",
              "value": "={{ $('criar evento').first().json.body.horario_confirmado_iso }}",
              "type": "string"
            },
            {
              "id": "c1730320-0603-413e-ab78-ed00bbd05d4f",
              "name": "intervalo_eventos",
              "value": "={{ $('criar evento').first().json.body.intervalo_eventos }}",
              "type": "string"
            },
            {
              "id": "37e2ee6e-a0d4-40e3-97e4-77ea6c654062",
              "name": "TelefoneAvisos",
              "value": "={{ $('criar evento').first().json.body.TelefoneAvisos }}",
              "type": "string"
            },
            {
              "id": "d70b6439-8d0d-482a-8ac0-55e8f78ffd58",
              "name": "Email",
              "value": "={{ $('puxa email').first().json.email }}",
              "type": "string"
            },
            {
              "id": "db4d1827-2eb2-4438-9abc-dd183a8ef21b",
              "name": "Data",
              "value": "={{ $('data hora').first().json.horario_envio_mensagem }}",
              "type": "string"
            },
            {
              "id": "93948afe-cf32-4ae9-8f19-142955ac0d78",
              "name": "Hora",
              "value": "={{ $('data hora').first().json.data_envio_mensagem }}",
              "type": "string"
            },
            {
              "id": "d40c094d-6e21-4c17-8edd-043d3f91bb51",
              "name": "DataHoraIso",
              "value": "={{ $('data hora').first().json.timestamp_iso }}",
              "type": "string"
            },
            {
              "id": "8813902a-325f-4cd8-bfc5-e6635b81e3d9",
              "name": "PixelMeta",
              "value": "617674611430743",
              "type": "string"
            },
            {
              "id": "506fa6a6-db1b-4747-a81d-d7e3ff2b81d7",
              "name": "TokenAPIMeta",
              "value": "EAALWbq7LOJoBPMoTA0h24PSyVsH4pHXZCHEyHs2U5zi4yZBYxdXQEDL3MxcRravbNZAKRACpMeZABVE9dQq0LcQMGT8TJZAZAqN4ZAfA4xzCEnKTCW8DjWLP3mj1eg1PRXimw30V8vseYQvP4wNvquGuyu7YZB72RC2c3cOiX7QfbsY6jqYJI3ZBEZA5XgLwVRvwZDZD",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3632,
        -1536
      ],
      "id": "dd705e30-0a79-4042-a8ed-517f456bcfad",
      "name": "campos evento"
    },
    {
      "parameters": {
        "jsCode": "// Obter o item de entrada\nconst item = items[0].json;\n\n// Extrair os dados\nconst startIso = item.horario_confirmado_iso;\nconst intervaloMinutos = parseInt(item.intervalo_eventos, 10);\n\n// Pegar o offset original (exemplo: -03:00)\nconst offsetStr = startIso.slice(-6); // Mais seguro que slice(19)\n\n// Parse offset para ajuste num√©rico\nconst sign = offsetStr[0] === '-' ? -1 : 1;\nconst offsetHours = parseInt(offsetStr.slice(1, 3), 10);\nconst offsetMins = parseInt(offsetStr.slice(4, 6), 10);\nconst totalOffsetMins = sign * (offsetHours * 60 + offsetMins);\n\n// Extrair manualmente os componentes da data de in√≠cio (opcional, mantido por compatibilidade)\nconst [datePart, timePartWithOffset] = startIso.split('T');\nconst timePart = timePartWithOffset.slice(0, 8); // HH:mm:ss (n√£o usado, mas mantido)\n\n// Criar o Date considerando o fuso\nconst startDate = new Date(startIso);\n\n// Calcular o hor√°rio de t√©rmino (UTC real)\nconst endDate = new Date(startDate.getTime() + intervaloMinutos * 60000);\n\n// Agora, transformar o endDate de volta para string no mesmo fuso original\nfunction formatWithOffset(dateObj, offsetStr, totalOffsetMins) {\n  // Come√ßar dos componentes UTC\n  let year = dateObj.getUTCFullYear();\n  let month = dateObj.getUTCMonth() + 1;\n  let day = dateObj.getUTCDate();\n  let hour = dateObj.getUTCHours();\n  let min = dateObj.getUTCMinutes();\n  let sec = dateObj.getUTCSeconds();\n\n  // Ajustar minutos pelo offset (local = UTC + offset, mas como offset √© signed)\n  min += totalOffsetMins;\n  while (min >= 60) {\n    min -= 60;\n    hour += 1;\n  }\n  while (min < 0) {\n    min += 60;\n    hour -= 1;\n  }\n  while (hour >= 24) {\n    hour -= 24;\n    day += 1;\n  }\n  while (hour < 0) {\n    hour += 24;\n    day -= 1;\n  }\n  // Ajuste de dia/m√™s/ano\n  while (day > (daysInMonth = new Date(year, month, 0).getDate())) {\n    day -= daysInMonth;\n    month += 1;\n  }\n  while (day < 1) {\n    month -= 1;\n    const daysInPrevMonth = new Date(year, month, 0).getDate();\n    day += daysInPrevMonth;\n  }\n  while (month > 12) {\n    month -= 12;\n    year += 1;\n  }\n  while (month < 1) {\n    month += 12;\n    year -= 1;\n  }\n\n  // Formatar string\n  return `${year.toString().padStart(4, '0')}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}T${hour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}${offsetStr}`;\n}\n\nconst endFinal = formatWithOffset(endDate, offsetStr, totalOffsetMins);\n\n// Retorno\nreturn [\n  {\n    json: {\n      start: startIso,\n      end: endFinal,\n    },\n  },\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3488,
        -1536
      ],
      "id": "a86974bc-33e1-47a6-a74b-0ed3ea6518cc",
      "name": "formata horarios"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('criar evento').first().json.body.Instancia.toLowerCase()  }}_sdr_leads",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $('criar evento').first().json.body.SessionID }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3952,
        -1536
      ],
      "id": "043794b1-6f29-4a58-b1d4-5273a38c06de",
      "name": "puxa email",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6682c2f8-496f-4dbe-8b35-bb59ace764e4",
              "leftValue": "={{ $('campos evento').first().json.Email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4448,
        -1312
      ],
      "id": "324220a4-bf67-46fe-a87d-9d8821ce667b",
      "name": "email vazio"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "490aba053d46ca104b5c75535829ac9039489d637fba39d713dc84a12c8a00bc@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "KRUGER Atendimento IA "
        },
        "start": "={{ $('formata horarios').first().json.start }}",
        "end": "={{ $('formata horarios').first().json.end }}",
        "additionalFields": {
          "attendees": [],
          "description": "=Wpp: {{ $('campos evento').first().json.SessionID }}",
          "summary": "IA | AGENDAMENTO"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        -4288,
        -1312
      ],
      "id": "af1e3483-e0b0-4829-90d8-e509042ecc0b",
      "name": "criar evento calendar sem invite",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "SiBx2sbnugOWgOZH",
          "name": "[KRUGER] Calendar"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.eduardofischborn.com.br/message/sendText/{{ $('campos evento').first().json.Instancia }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=55{{ $('campos evento').first().json.TelefoneAvisos }}"
            },
            {
              "name": "text",
              "value": "=üìà | **NOVO AGENDAMENTO** |\n\nüìÖ  *Data: {{ $('campos evento').first().json.horario_confirmado_iso }}*\n\n‚Ä¢ `Whatsapp` - {{ $('campos evento').first().json.SessionID }}\n‚Ä¢ `Email` - {{ $('campos evento').first().json.Email }}\n\nüí¨  *Resumo:*\n{{ $('criar evento').first().json.body.ResumoConversa }}"
            },
            {
              "name": "presence",
              "value": "composing"
            },
            {
              "name": "linkPreview",
              "value": "={{ false }}"
            },
            {
              "name": "delay",
              "value": "={{ 2500 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7ff83614-631d-42bf-a454-ce87874dea70",
      "name": "avisa evento zap",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3792,
        -1312
      ],
      "executeOnce": true,
      "credentials": {
        "httpHeaderAuth": {
          "id": "rPARANITH2QYrjl5",
          "name": "[1] EVOLUTION"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obter os dados de entrada (assumindo que est√£o no campo 'datetime')\nlet inputString = $now.toString(); // Garantir que √© uma string\n\n// Fun√ß√£o para retornar os 10 primeiros caracteres (data)\nfunction FirstTen(input) {\n    return input.substring(0, 10);\n}\n\n// Fun√ß√£o para formatar a data no formato DIA/M√äS/ANO\nfunction FormatDateToDMY(input) {\n    const [year, month, day] = input.split('-');\n    return `${day}/${month}/${year}`;\n}\n\n// Fun√ß√£o para retornar os caracteres de 11 a 19 (hora)\nfunction ElevenToNineteen(input) {\n    return input.substring(11, 19);\n}\n\n// Fun√ß√£o para gerar timestamp ISO (at√© os segundos)\nfunction GetTimestampISO(input) {\n    return input.substring(0, 19);\n}\n\n// Manter os 19 primeiros caracteres\nconst HorarioEnvioMensagem = ElevenToNineteen(inputString);\nconst DataEnvioMensagem = FormatDateToDMY(FirstTen(inputString));\nconst TimestampISO = GetTimestampISO(inputString);\n\n// Retornar os resultados\nreturn {\n    json: {\n        horario_envio_mensagem: HorarioEnvioMensagem,\n        data_envio_mensagem: DataEnvioMensagem,\n        timestamp_iso: TimestampISO\n    }\n};\n"
      },
      "id": "88582c3c-fe8d-4415-a4f0-d3163256a77c",
      "name": "data hora",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4096,
        -1536
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('criar evento').first().json.body.FluxoAgendamentos }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "horario_evento",
              "value": "={{ $('formata horarios').first().json.start }}"
            },
            {
              "name": "whatsapp",
              "value": "={{ $('campos evento').first().json.SessionID }}"
            },
            {
              "name": "Instancia",
              "value": "={{ $('campos evento').first().json.Instancia }}"
            },
            {
              "name": "TelefoneAvisos",
              "value": "={{ $('campos evento').first().json.TelefoneAvisos }}"
            },
            {
              "name": "status",
              "value": "={{ $json.status }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3328,
        -1312
      ],
      "id": "33e0e0ba-4491-45a4-9dd8-d266ff934692",
      "name": "fluxo agendamentos",
      "executeOnce": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.payload }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2896,
        -1312
      ],
      "id": "5ddf9734-7f68-469d-86df-dca57f034fe9",
      "name": "mql meta",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// =================================================================\n// --- IN√çCIO DA IMPLEMENTA√á√ÉO DO SHA-256 (VERS√ÉO CORRIGIDA) ---\n// =================================================================\nfunction sha256(ascii) {\n    function rightRotate(value, amount) {\n        return (value >>> amount) | (value << (32 - amount));\n    };\n\n    var mathPow = Math.pow;\n    var maxWord = mathPow(2, 32);\n    var k = [];\n    var H = [];\n    var T = [];\n\n    var W = new Array(64);\n    var primeCounter = 0;\n\n    var isComposite = {};\n    for (var candidate = 2; primeCounter < 64; candidate++) {\n        if (!isComposite[candidate]) {\n            for (var i = 0; i < 313; i += candidate) {\n                isComposite[i] = candidate;\n            }\n            k[primeCounter] = (mathPow(candidate, .5) * maxWord) | 0;\n            H[primeCounter++] = (mathPow(candidate, 1 / 3) * maxWord) | 0;\n        }\n    }\n\n    ascii += '\\x80'; // Tabela de caracteres ASCII\n    while (ascii.length % 64 - 56) ascii += '\\x00';\n    for (var i = 0; i < ascii.length; i++) {\n        var j = ascii.charCodeAt(i);\n        if (j >> 8) return;\n        T[i >> 2] |= j << ((3 - i) % 4) * 8;\n    }\n    T[T.length] = ((ascii.length - 1) * 8) / maxWord | 0;\n    T[T.length] = ((ascii.length - 1) * 8);\n\n    for (var j = 0; j < T.length;) {\n        var a = H[0],\n            b = H[1],\n            c = H[2],\n            d = H[3],\n            e = H[4],\n            f = H[5],\n            g = H[6],\n            h = H[7];\n\n        for (var i = 0; i < 64; i++) {\n            if (i < 16) W[i] = T[j + i];\n            else W[i] = (rightRotate(W[i - 2], 17) ^ rightRotate(W[i - 2], 19) ^ (W[i - 2] >>> 10)) + W[i - 7] + (rightRotate(W[i - 15], 7) ^ rightRotate(W[i - 15], 18) ^ (W[i - 15] >>> 3)) + W[i - 16];\n\n            var T1 = h + (rightRotate(e, 6) ^ rightRotate(e, 11) ^ rightRotate(e, 25)) + ((e & f) ^ ((~e) & g)) + k[i] + (W[i] | 0);\n            var T2 = (rightRotate(a, 2) ^ rightRotate(a, 13) ^ rightRotate(a, 22)) + ((a & b) ^ (a & c) ^ (b & c));\n\n            h = g;\n            g = f;\n            f = e;\n            e = (d + T1) | 0;\n            d = c;\n            c = b;\n            b = a;\n            a = (T1 + T2) | 0;\n        }\n\n        H[0] = (H[0] + a) | 0;\n        H[1] = (H[1] + b) | 0;\n        H[2] = (H[2] + c) | 0;\n        H[3] = (H[3] + d) | 0;\n        H[4] = (H[4] + e) | 0;\n        H[5] = (H[5] + f) | 0;\n        H[6] = (H[6] + g) | 0;\n        H[7] = (H[7] + h) | 0;\n        j += 16;\n    }\n\n    var result = '';\n    for (var i = 0; i < 8; i++) {\n        result += ('0000000' + H[i].toString(16)).slice(-8);\n    }\n    return result;\n}\n// =================================================================\n// --- FIM DA IMPLEMENTA√á√ÉO DO SHA-256 ---\n// =================================================================\n\n\n// =================================================================\n// --- IN√çCIO DA SUA L√ìGICA DE WORKFLOW ---\n// =================================================================\n// (O restante do seu c√≥digo permanece exatamente o mesmo)\n\nconst nodeCamposEvento = $('campos evento').first().json;\nconst PIXEL_ID = nodeCamposEvento.PixelMeta;\nconst ACCESS_TOKEN = nodeCamposEvento.TokenAPIMeta;\n\nconst nodePuxaEmail = $('puxa email').first().json;\nconst rawNome = nodePuxaEmail.Nome;\nconst rawEmail = nodePuxaEmail.Email;\nconst rawTelefone = nodePuxaEmail.Whatsapp;\n\nconst isDataValid = (data) => {\n  if (!data) return false;\n  if (Array.isArray(data) && (data.length === 0 || data[0] === null)) {\n    return false;\n  }\n  return true;\n};\n\nlet nomeLimpo = '';\nif (isDataValid(rawNome)) {\n  nomeLimpo = rawNome.toString().split(' ')[0].toLowerCase();\n}\n\nlet emailLimpo = '';\nif (isDataValid(rawEmail)) {\n  emailLimpo = rawEmail.toString().toLowerCase();\n}\n\nlet telefoneFormatado = '';\nif (isDataValid(rawTelefone)) {\n  telefoneFormatado = `55${rawTelefone.toString()}`;\n}\n\nif (!emailLimpo && !telefoneFormatado) {\n  console.log(\"Item ignorado: Nenhum identificador (email ou telefone) v√°lido encontrado.\");\n  return null;\n}\n\nconst user_data = {};\nif (emailLimpo) {\n  user_data.em = sha256(emailLimpo);\n}\nif (telefoneFormatado) {\n  user_data.ph = sha256(telefoneFormatado);\n}\nif (nomeLimpo) {\n  user_data.fn = sha256(nomeLimpo);\n}\n\nconst timestamp = Math.floor(Date.now() / 1000);\n\nconst payload = {\n  data: [\n    {\n      event_name: \"Lead\",\n      event_time: timestamp,\n      action_source: \"chat\",\n      user_data: user_data,\n    },\n  ],\n  access_token: ACCESS_TOKEN,\n};\n\nconsole.log(\"Payload preparado para envio:\", JSON.stringify(payload, null, 2));\n\nreturn [{\n  json: {\n    url: `https://graph.facebook.com/v20.0/${PIXEL_ID}/events`,\n    payload: payload,\n  },\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3040,
        -1312
      ],
      "id": "194e2e81-d3c1-4171-8109-20695d27ed5d",
      "name": "formata dados pra meta"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=Evento criado com sucesso. {{$execution.id}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -3184,
        -1312
      ],
      "id": "11b75288-bcd5-4206-9c0b-59373df324b9",
      "name": "r criar evento"
    },
    {
      "parameters": {
        "tableId": "={{ $('campos evento').first().json.Instancia.toLowerCase() }}_sdr_agendamentos",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nome_cliente",
              "fieldValue": "={{ $('puxa email').first().json.Nome }}"
            },
            {
              "fieldId": "whatsapp",
              "fieldValue": "={{ $('campos evento').first().json.SessionID }}"
            },
            {
              "fieldId": "status_agendamento",
              "fieldValue": "Confirmado"
            },
            {
              "fieldId": "data_contato",
              "fieldValue": "={{ $('campos evento').first().json.DataHoraIso }}"
            },
            {
              "fieldId": "data_cancelamento"
            },
            {
              "fieldId": "data_inicio_evento",
              "fieldValue": "={{ $('formata horarios').first().json.start }}"
            },
            {
              "fieldId": "data_fim_evento",
              "fieldValue": "={{ $('formata horarios').first().json.end }}"
            },
            {
              "fieldId": "calendar_id",
              "fieldValue": "={{ $json.id }}"
            },
            {
              "fieldId": "data_agendamento",
              "fieldValue": "={{ $('data hora').first().json.data_envio_mensagem }}"
            }
          ]
        }
      },
      "id": "ab003900-8885-43bd-8509-9917303db0d2",
      "name": "preenche tabela agendamentos",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3952,
        -1312
      ],
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.eduardofischborn.com.br/message/sendText/{{ $('campos evento').first().json.Instancia }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=555499854458"
            },
            {
              "name": "text",
              "value": "=üìà | **NOVO AGENDAMENTO** |\n\nüìÖ  *Data: {{ $('campos evento').first().json.horario_confirmado_iso }}*\n\n‚Ä¢ `Whatsapp` - {{ $('campos evento').first().json.SessionID }}\n‚Ä¢ `Email` - {{ $('campos evento').first().json.Email }}\n\nüí¨  *Resumo:*\n{{ $('criar evento').first().json.body.ResumoConversa }}"
            },
            {
              "name": "presence",
              "value": "composing"
            },
            {
              "name": "linkPreview",
              "value": "={{ false }}"
            },
            {
              "name": "delay",
              "value": "={{ 2500 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "61f96e04-d6d2-4b86-8b86-61486a94b791",
      "name": "avisa evento zap1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3632,
        -1312
      ],
      "executeOnce": true,
      "credentials": {
        "httpHeaderAuth": {
          "id": "rPARANITH2QYrjl5",
          "name": "[1] EVOLUTION"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('criar evento').first().json.body.Instancia.toLowerCase()  }}_sdr_agendamentos",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $('criar evento').first().json.body.SessionID }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2896,
        -1536
      ],
      "id": "ae7842e2-8358-4850-bccd-7d0069af23de",
      "name": "puxa agendamentos",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6ee7dfbd-9f19-41fb-9ebd-8bfc4e490e3d",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2736,
        -1536
      ],
      "id": "c4c09e57-aa29-46db-8ab1-ca96145eafd6",
      "name": "reagendar",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "update",
        "calendar": {
          "__rl": true,
          "value": "490aba053d46ca104b5c75535829ac9039489d637fba39d713dc84a12c8a00bc@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "KRUGER Atendimento IA "
        },
        "eventId": "={{ $('puxa agendamentos').first().json.calendar_id }}",
        "updateFields": {
          "description": "=# REAGENDADO\n\nHor√°rio original:\n{{ $('puxa agendamentos').first().json.data_inicio_evento }}\n\nWpp: {{ $('campos evento').first().json.SessionID }}",
          "end": "={{ $('formata horarios').first().json.end }}",
          "start": "={{ $('formata horarios').first().json.start }}",
          "summary": "IA | AGENDAMENTO"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        -2560,
        -1568
      ],
      "id": "a26bd8e9-ab96-4ca8-a57d-044417777b46",
      "name": "update evento",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "SiBx2sbnugOWgOZH",
          "name": "[KRUGER] Calendar"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('criar evento').first().json.body.Instancia.toLowerCase()  }}_sdr_agendamentos",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('puxa agendamentos').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status_agendamento",
              "fieldValue": "Reagendado"
            },
            {
              "fieldId": "data_inicio_evento",
              "fieldValue": "={{ $('formata horarios').first().json.start }}"
            },
            {
              "fieldId": "data_fim_evento",
              "fieldValue": "={{ $('formata horarios').first().json.end }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2368,
        -1552
      ],
      "id": "79456eb9-5654-4af4-be7e-39c3afb3e7b3",
      "name": "atualiza reagendamento",
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Function node (Run Once for All Items)\n\n// 1) Buscar o campo \"dados\" do node anterior\nconst raw = $('puxa email').first().json.dados;\nif (raw == null) {\n  throw new Error('Campo \"dados\" n√£o encontrado no node \"puxa email\".');\n}\n\n// 2) Garantir que seja um objeto JS\nlet dados;\nif (typeof raw === 'string') {\n  try {\n    dados = JSON.parse(raw); // string JSON -> objeto\n  } catch (err) {\n    throw new Error('Campo \"dados\" √© uma string, mas n√£o √© JSON v√°lido: ' + err.message);\n  }\n} else if (typeof raw === 'object') {\n  dados = raw; // j√° √© objeto\n} else {\n  throw new Error('Tipo inesperado para \"dados\": ' + typeof raw);\n}\n\n// 3) Se vier embrulhado como { dados: {...} }, desembrulhar\nif (dados && typeof dados === 'object' && 'dados' in dados && typeof dados.dados === 'object') {\n  dados = dados.dados;\n}\n\n// 4) Retornar um √∫nico item com v√°rias chaves (conte√∫do de \"dados\")\nreturn [\n  { json: dados }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3792,
        -1536
      ],
      "id": "c733e8d7-dd30-4ad7-8891-c4008d1a911d",
      "name": "dados lead"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sdrtoolagendakruger",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "78ee411e-3538-4a5f-b68d-0d07146f9978",
      "name": "gerenciar agenda",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4416,
        -1936
      ],
      "webhookId": "ace9234e-1844-4f6e-a0e3-a59ea40e98ba"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2c20ab80-bc00-4cc6-9a42-b54ca72a6c7e",
              "name": "regras",
              "value": "={\"duracao_minutos\":{{ $('gerenciar agenda').first().json.body.duracao_agendamento }},\"buffer_futuro_horas\":{{ $('gerenciar agenda').first().json.body.tempo_previo_agendamento }},\"dias_uteis\":{{ $('gerenciar agenda').first().json.body.horarios_agendamentos }}}",
              "type": "object"
            },
            {
              "id": "0cafaee4-2133-43df-a858-ce392dbe26f3",
              "name": "busy_events_formatted",
              "value": "={{ $json.horarios_ocupados }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3280,
        -1936
      ],
      "id": "c963e371-93d2-4cab-ad84-23b76965b4e4",
      "name": "regras_de_agendamento"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nfunction splitDateTime(value) {\n  if (!value) {\n    return { raw: null, date: null, time: null, iso: null };\n  }\n\n  const d = new Date(value);\n  if (!isNaN(d)) {\n    const pad = n => String(n).padStart(2, '0');\n    return {\n      raw: value,\n      date: d.toISOString().slice(0, 10), // YYYY-MM-DD\n      time: `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`, // HH:MM:SS\n      iso: d.toISOString(),\n    };\n  }\n\n  const [datePart, timePart] = String(value).split(/[ T]/);\n  return { raw: value, date: datePart || null, time: timePart || null, iso: null };\n}\n\n// monta todos os eventos\nconst eventos = items.map(({ json }) => {\n  const start = splitDateTime(json.data_inicio_evento);\n  const end   = splitDateTime(json.data_fim_evento);\n\n  return {\n    start_raw: start.raw,\n    start_date: start.date,\n    start_time: start.time,\n    end_raw: end.raw,\n    end_date: end.date,\n    end_time: end.time,\n  };\n});\n\n// retorna apenas um item, com a array \"horarios_ocupados\"\nreturn [{\n  json: {\n    horarios_ocupados: eventos\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3424,
        -1936
      ],
      "id": "345cc275-27a5-422e-ba67-397e95d06e49",
      "name": "formata eventos"
    },
    {
      "parameters": {
        "jsCode": "/*\n  NOVO PAPEL: Preparador de Contexto de Agendamento\n\n  Este c√≥digo tem uma √∫nica responsabilidade: pegar as regras e\n  a lista de eventos ocupados, limp√°-los e pass√°-los para frente\n  em um formato simples e padronizado.\n*/\n\n// 1. Pega os dados que chegam no n√≥.\nconst input = items[0].json;\n\n// 2. Extrai as regras de neg√≥cio.\n// Adicionamos uma verifica√ß√£o para garantir que os dados essenciais existem.\nconst regras = input.regras;\nif (!regras || typeof regras.duracao_minutos === 'undefined') {\n  throw new Error(\"O objeto 'regras' est√° ausente ou incompleto na entrada.\");\n}\n\n// 3. Extrai e simplifica a lista de eventos ocupados.\n// Para a l√≥gica de colis√£o, s√≥ precisamos do hor√°rio de in√≠cio de cada evento.\n// O campo `start_raw` √© o mais confi√°vel por conter o fuso hor√°rio (offset).\nconst eventos_ocupados = (input.busy_events_formatted || [])\n  .map(evento => {\n    // Garante que o evento e a propriedade `start_raw` existem.\n    if (evento && typeof evento.start_raw === 'string') {\n      return evento.start_raw;\n    }\n    return null; // Marca eventos inv√°lidos como nulos.\n  })\n  .filter(evento => evento !== null); // Remove quaisquer entradas nulas/inv√°lidas.\n\n// 4. Monta o objeto de sa√≠da final.\n// Este √© o \"contexto\" limpo que os pr√≥ximos n√≥s ir√£o consumir.\nconst output = {\n  json: {\n    contexto_agenda: {\n      regras: regras,\n      eventos_ocupados: eventos_ocupados\n    }\n  }\n};\n\n// 5. Retorna o novo item para o fluxo de trabalho.\nreturn [output];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3136,
        -1936
      ],
      "id": "0970c7ab-831f-4f85-b82d-26cd3dd86b3c",
      "name": "horarios livres"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('gerenciar agenda').first().json.body.tipo_de_busca }}",
                    "rightValue": "=sugerir_iniciais",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "d0eebdcb-6b73-4cd4-baf9-ce37a3e93b1c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "sugerir_iniciais"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9ee24e96-8373-4389-8acc-cf29d80eb2c1",
                    "leftValue": "={{ $('gerenciar agenda').first().json.body.tipo_de_busca }}",
                    "rightValue": "verificar_especifico",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "verificar_especifico"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0b2bb31b-0437-406f-a5f6-c73ac91284e7",
                    "leftValue": "={{ $('gerenciar agenda').first().json.body.tipo_de_busca }}",
                    "rightValue": "sugerir_proximos",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "sugerir_proximos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2992,
        -1952
      ],
      "id": "ca228358-4dfa-4f9d-9271-5075be8f8954",
      "name": "switch"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=Sugest√£o 2 hor√°rios mais pr√≥ximos: \n\nhor√°rio1:\n{{ $('blocos livres').first().json.primeiro_horario_manha }}\n\nhor√°rio2:\n{{ $('blocos livres').first().json.primeiro_horario_tarde }}\n\nN¬∫ da execu√ß√£o: {{$execution.id}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.3,
      "position": [
        -2496,
        -1936
      ],
      "id": "26d56eb6-811a-44f1-b369-fe006607eb55",
      "name": "resposta inicio"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Sua √∫nica e exclusiva tarefa √© atuar como um interpretador de datas em texto livre. Voc√™ deve determinar qual √© a data inicial (o dia) que o usu√°rio pretende agendar.\n\n# Contexto Principal\n- Data e Hora Atuais (fuso America/Sao_Paulo): {{ $now.setZone('America/Sao_Paulo').toISO() }}\n- Solicita√ß√£o de Data do Usu√°rio: \"{{ $('gerenciar agenda').first().json.body.data }}\"\n- Solicita√ß√£o de Hor√°rio do Usu√°rio: \"{{ $('gerenciar agenda').first().json.body.horario }}\"\n\n# Sua Tarefa\n1.  Analise a combina√ß√£o das solicita√ß√µes de data e hor√°rio do usu√°rio para entender a data que ele tem em mente.\n2.  Ignore o per√≠odo espec√≠fico (manh√£, tarde, noite), foque apenas em descobrir **O DIA** no formato AAAA-MM-DD.\n3.  Use a \"Data e Hora Atuais\" como sua √∫nica refer√™ncia para todos os c√°lculos de tempo.\n\n# Exemplos de L√≥gica (baseado em hoje ser Quinta-feira, 2025-10-02)\n- Se o usu√°rio diz \"semana que vem\", a data alvo √© a pr√≥xima segunda-feira, \"2025-10-06\".\n- Se o usu√°rio diz \"amanh√£\", a data alvo √© \"2025-10-03\".\n- Se o usu√°rio diz \"s√°bado\", a data alvo √© o pr√≥ximo s√°bado, \"2025-10-04\".\n- Se o usu√°rio diz \"pr√≥xima quinta-feira\", a data alvo √© a quinta da semana que vem, \"2025-10-09\".\n- Se o usu√°rio diz \"hoje\" ou deixa a data vazia, a data alvo √© a data atual, \"2025-10-02\".\n- Se o usu√°rio diz \"daqui a 3 semanas\", a data alvo √© \"2025-10-23\".\n\n# Formato da Sa√≠da Obrigat√≥rio\nResponda APENAS com um objeto JSON v√°lido, sem nenhum texto, explica√ß√£o, racioc√≠nio ou formata√ß√£o extra. O formato deve ser exatamente:\n{\n  \"data_alvo\": \"YYYY-MM-DD\"\n}\nN√ÉO inclua markdown como ```json ... ``` na sua resposta.",
        "hasOutputParser": true
      },
      "id": "72199ed6-71b0-47f4-9e15-cb426f7cb49a",
      "name": "entenda data",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        -4080,
        -1936
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Obter os dados de entrada (assumindo que est√£o no campo 'inputDateTime')\nlet inputText = item.json[\"text\"];\n\n// Fun√ß√£o para extrair o conte√∫do entre as tags </datafinal>\nfunction extractDateFinal(text) {\n    const match = text.match(/<datafinal>\\s*(.*?)\\s*<\\/datafinal>/);\n    return match ? match[1].trim() : null;\n}\n\n// Fun√ß√£o para formatar a data e hora\nfunction convertToISO(input) {\n    if (!input) return null;\n\n    // Separar data e hora\n    const [datePart, timePart] = input.split(' √†s ');\n\n    // Definir o ano atual\n    const currentYear = new Date().getFullYear();\n\n    // Formatar a data para YYYY-MM-DD\n    let [day, month] = datePart.includes('/') ? datePart.split('/') : datePart.split('-');\n    day = day.padStart(2, '0');\n    month = month.padStart(2, '0');\n    const formattedDate = `${currentYear}-${month}-${day}`;\n\n    // Formatar o hor√°rio para HH:MM:SS\n    const [hour, minute] = timePart.replace('h', '').split(':');\n    const formattedTime = `${hour.padStart(2, '0')}:${minute.padStart(2, '0')}:00`;\n\n    // Combinar data e hora no formato ISO 8601\n    return `${formattedDate}T${formattedTime}`;\n}\n\n// Extra√ß√£o do trecho dentro das tags\nconst extractedInput = extractDateFinal(inputText);\n\n// Convers√£o para ISO\nconst formattedString = convertToISO(extractedInput);\n\n// Retornar o resultado formatado\nreturn {\n    json: {\n        horario_solicitado_agendamento: formattedString\n    }\n};\n"
      },
      "id": "9bb5e039-cd15-484d-9015-40000915a253",
      "name": "data para ISO",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3824,
        -1936
      ],
      "disabled": true
    },
    {
      "parameters": {
        "model": "gpt-5-mini",
        "options": {}
      },
      "id": "0d257e81-a7d3-46bf-a11f-5e145e99b8dd",
      "name": "gpt1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -3952,
        -1856
      ],
      "credentials": {
        "openAiApi": {
          "id": "nIAJKQcNsxgZl09A",
          "name": "[KRUGER] OPENAI"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1fd18a14-0b6a-4acc-afee-d6c80de171e5",
              "leftValue": "={{ typeof $('gerenciar agenda').first().json.body.horario === \"string\" }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "9198b2c3-e89b-47b2-b3b3-3b5d34201b35",
              "leftValue": "={{ $('gerenciar agenda').first().json.body.horario }}",
              "rightValue": "vazio",
              "operator": {
                "type": "string",
                "operation": "notContains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2656,
        -1936
      ],
      "id": "078b81fa-d527-45b0-bcf6-f0e3f52dced2",
      "name": "string"
    },
    {
      "parameters": {
        "model": "gpt-5-mini",
        "options": {}
      },
      "id": "37d3287d-7c68-4173-93f8-b55658c631ff",
      "name": "gpt",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -2192,
        -1856
      ],
      "credentials": {
        "openAiApi": {
          "id": "nIAJKQcNsxgZl09A",
          "name": "[KRUGER] OPENAI"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Voc√™ √© um assistente de agendamento de elite, um especialista em l√≥gica de calend√°rios e interpreta√ß√£o de linguagem natural. Sua tarefa √© analisar a solicita√ß√£o de um usu√°rio e todos os dados brutos da agenda para determinar a melhor a√ß√£o e fornecer uma resposta precisa em formato JSON.\n\n# Dados Brutos\n- Data e Hora Atuais (fuso America/Sao_Paulo): {{ $now.setZone('America/Sao_Paulo').toISO() }}\n- Solicita√ß√£o de Data do Usu√°rio: \"{{ $('gerenciar agenda').first().json.body.data || \"\" }}\"\n- Solicita√ß√£o de Hor√°rio do Usu√°rio: \"{{ $('gerenciar agenda').first().json.body.horario || \"\" }}\"\n- Regras da Agenda (JSON): {{ JSON.stringify($('horarios livres').first().json.contexto_agenda.regras) }}\n- Eventos J√° Agendados (ISO 8601): {{ JSON.stringify($('horarios livres').first().json.contexto_agenda.eventos_ocupados) }}\n\n## Passo a Passo Obrigat√≥rio de Racioc√≠nio\nSiga EXATAMENTE estes passos para chegar √† sua conclus√£o.\n\n### Passo 1: An√°lise da Solicita√ß√£o e Defini√ß√£o da A√ß√£o\n1.  Analise a combina√ß√£o da \"Solicita√ß√£o de Data\" e \"Solicita√ß√£o de Hor√°rio\".\n2.  Determine se o pedido √© para um **hor√°rio espec√≠fico** (ex: \"15/10/2025 √†s 16h\", \"ter√ßa 10h\") ou para uma **sugest√£o de hor√°rios** (ex: \"tarde\", \"semana que vem\", ou ambos vazios).\n3.  Defina a `acao_a_ser_executada` como `VERIFICAR_ESPECIFICO` ou `SUGERIR_HORARIOS`.\n\n### Passo 2: Execu√ß√£o da A√ß√£o\n\n#### SE a a√ß√£o for `VERIFICAR_ESPECIFICO`:\n1.  Converta o pedido do usu√°rio para uma data e hora ISO 8601 completa.\n2.  Calcule o in√≠cio e o fim do hor√°rio solicitado, usando a dura√ß√£o das \"Regras da Agenda\".\n3.  **Verifica√ß√£o 1 (Regras):** O hor√°rio solicitado est√° dentro dos dias e hor√°rios de funcionamento definidos nas \"Regras da Agenda\"?\n4.  **Verifica√ß√£o 2 (Conflitos):** O hor√°rio solicitado se sobrep√µe a algum dos \"Eventos J√° Agendados\"?\n5.  Com base nas verifica√ß√µes, defina a `disponibilidade` como `true` ou `false` e um `motivo` claro.\n\n#### SE a a√ß√£o for `SUGERIR_HORARIOS`:\n1.  **Determine a Janela de Busca:** Interprete a \"Solicita√ß√£o de Data do Usu√°rio\" para definir uma `data_de_partida`. Se a solicita√ß√£o for vazia ou \"hoje\", a `data_de_partida` √© a \"Data e Hora Atuais\". Se for \"amanh√£\", \"semana que vem\", \"daqui 30 dias\", calcule a `data_de_partida` correspondente.\n2.  **C√°lculo Mental de Disponibilidade:**\n    a. Mentalmente, para os pr√≥ximos 7 dias a partir da `data_de_partida`, crie \"blocos de tempo de trabalho\" com base nas \"Regras da Agenda\".\n    b. \"Subtraia\" os \"Eventos J√° Agendados\" desses blocos de trabalho para encontrar os intervalos livres.\n    c. Leve em conta a \"Data e Hora Atuais\" para garantir que nenhuma sugest√£o seja no passado.\n3.  **Filtragem e Coleta:**\n    a. Dentro desses intervalos livres, encontre os **2 primeiros hor√°rios de in√≠cio de agendamento** poss√≠veis.\n    b. Se o usu√°rio especificou um per√≠odo (Manh√£: 0-11, Tarde: 12-17, Noite: 18+), filtre os resultados para aquele per√≠odo.\n    c. Se o usu√°rio n√£o especificou nada, simplesmente encontre os 2 primeiros hor√°rios livres (um de manh√£ e um de tarde, se poss√≠vel, conforme a sa√≠da do `blocos livres` que j√° fazia).\n4.  Armazene os resultados em uma lista `horarios_sugeridos`.\n\n# Formato da Sa√≠da Obrigat√≥rio\nSua resposta final deve ser um √∫nico objeto JSON, estruturado de acordo com a a√ß√£o que voc√™ executou.\n\n### SE a a√ß√£o foi `VERIFICAR_ESPECIFICO`, use este formato:\n{\n  \"acao_executada\": \"VERIFICAR_ESPECIFICO\",\n  \"disponibilidade\": boolean,\n  \"motivo\": \"string\"\n}\n\n### SE a a√ß√£o foi `SUGERIR_HORARIOS`, use este formato:\n{\n  \"acao_executada\": \"SUGERIR_HORARIOS\",\n  \"horarios_sugeridos\": [\n    \"YYYY-MM-DDTHH:MM:SS-03:00\",\n    \"YYYY-MM-DDTHH:MM:SS-03:00\"\n  ]\n}\n\nN√ÉO inclua nenhum outro texto ou explica√ß√£o. Apenas o JSON final.",
        "hasOutputParser": true
      },
      "id": "00a00035-d9a4-4da9-be57-b74903084315",
      "name": "escolhe periodo",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        -2336,
        -1936
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=Disponibilidade:\n{{ $json.output.disponibilidade }}\n\nHor√°rios sugeridos (se houver):\n{{ $json.output.horarios_sugeridos }}\n\nN¬∫ da execu√ß√£o: {{$execution.id}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.3,
      "position": [
        -2048,
        -1936
      ],
      "id": "85c3edd4-ac71-4cfb-8994-efe81a88782f",
      "name": "resposta inicio periodo"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "={{ $('gerenciar agenda').first().json.body.Instancia.toLowerCase() }}_sdr_agendamentos",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "data_inicio_evento",
              "condition": "gt",
              "keyValue": "={{ $now.set({ hour: 0, minute: 0, second: 0 }).toFormat(\"yyyy-LL-dd'T'HH:mm:ssZZ\") }}"
            },
            {
              "keyName": "status_agendamento",
              "condition": "neq",
              "keyValue": "Cancelado"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3680,
        -1936
      ],
      "id": "43da858f-3b21-4eeb-be13-ce22aa0dd78b",
      "name": "puxa eventos",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"acao_executada\": \"VERIFICAR_ESPECIFICO\",\n  \"disponibilidade\": \"true\",\n  \"motivo\": \"string\",\n  \"horarios_sugeridos\": [\n   \"YYYY-MM-DDTHH:MM:SS-03:00\",\n   \"YYYY-MM-DDTHH:MM:SS-03:00\"\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -2304,
        -1856
      ],
      "id": "c1b4b61c-a861-4a8a-99bc-6b99be4522b8",
      "name": "parser"
    },
    {
      "parameters": {
        "tableId": "={{ $('novo evento').first().json.organizer.displayName.toLowerCase().split(' ')[0] }}_sdr_agendamentos",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status_agendamento",
              "fieldValue": "Confirmado"
            },
            {
              "fieldId": "calendar_id",
              "fieldValue": "={{ $('novo evento').first().json.id }}"
            },
            {
              "fieldId": "data_contato",
              "fieldValue": "={{ $json.timestamp_iso }}"
            },
            {
              "fieldId": "data_agendamento",
              "fieldValue": "={{ $json.data_envio_mensagem }}"
            },
            {
              "fieldId": "data_inicio_evento",
              "fieldValue": "={{ $('novo evento').first().json.start.dateTime }}"
            },
            {
              "fieldId": "data_fim_evento",
              "fieldValue": "={{ $('novo evento').first().json.end.dateTime }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2256,
        -1280
      ],
      "id": "1c389c31-f419-4b8c-8b47-f4dcf5a9dfd7",
      "name": "cria evento",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obter os dados de entrada (assumindo que est√£o no campo 'datetime')\nlet inputString = $now.toString(); // Garantir que √© uma string\n\n// Fun√ß√£o para retornar os 10 primeiros caracteres (data)\nfunction FirstTen(input) {\n    return input.substring(0, 10);\n}\n\n// Fun√ß√£o para formatar a data no formato DIA/M√äS/ANO\nfunction FormatDateToDMY(input) {\n    const [year, month, day] = input.split('-');\n    return `${day}/${month}/${year}`;\n}\n\n// Fun√ß√£o para retornar os caracteres de 11 a 19 (hora)\nfunction ElevenToNineteen(input) {\n    return input.substring(11, 19);\n}\n\n// Fun√ß√£o para gerar timestamp ISO (at√© os segundos)\nfunction GetTimestampISO(input) {\n    return input.substring(0, 19);\n}\n\n// Manter os 19 primeiros caracteres\nconst HorarioEnvioMensagem = ElevenToNineteen(inputString);\nconst DataEnvioMensagem = FormatDateToDMY(FirstTen(inputString));\nconst TimestampISO = GetTimestampISO(inputString);\n\n// Retornar os resultados\nreturn {\n    json: {\n        horario_envio_mensagem: HorarioEnvioMensagem,\n        data_envio_mensagem: DataEnvioMensagem,\n        timestamp_iso: TimestampISO\n    }\n};\n"
      },
      "id": "190621a2-ee02-4fc4-9d4c-3f6fe927e861",
      "name": "data hora calendar",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2400,
        -1280
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chatbottoolskruger",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1568,
        -1120
      ],
      "id": "46c3ac57-4328-4afb-9273-db1b5861d8cd",
      "name": "tool hub",
      "webhookId": "a84712e0-b30e-47ff-8bfa-eb863ae4c602"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('tool hub').first().json.body.instancia.toLowerCase() }}_sdr_leads",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $('tool hub').first().json.body.sessionid }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -880,
        -1120
      ],
      "id": "3929b2e3-d358-4e51-9a34-ff85a918f111",
      "name": "puxa lead",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "content": "# CANCELA AGENDAMENTO\n",
        "height": 340,
        "width": 2225,
        "color": 4
      },
      "id": "0c518385-5c63-40db-a4e8-275dc6d67688",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4512,
        -1056
      ]
    },
    {
      "parameters": {
        "jsCode": "// Obter os dados de entrada (assumindo que est√£o no campo 'datetime')\nlet inputString = $now.toString(); // Garantir que √© uma string\n\n// Fun√ß√£o para retornar os 10 primeiros caracteres (data)\nfunction FirstTen(input) {\n    return input.substring(0, 10);\n}\n\n// Fun√ß√£o para formatar a data no formato DIA/M√äS/ANO\nfunction FormatDateToDMY(input) {\n    const [year, month, day] = input.split('-');\n    return `${day}/${month}/${year}`;\n}\n\n// Fun√ß√£o para retornar os caracteres de 11 a 19 (hora)\nfunction ElevenToNineteen(input) {\n    return input.substring(11, 19);\n}\n\n// Fun√ß√£o para gerar timestamp ISO (at√© os segundos)\nfunction GetTimestampISO(input) {\n    return input.substring(0, 19);\n}\n\n// Manter os 19 primeiros caracteres\nconst HorarioEnvioMensagem = ElevenToNineteen(inputString);\nconst DataEnvioMensagem = FormatDateToDMY(FirstTen(inputString));\nconst TimestampISO = GetTimestampISO(inputString);\n\n// Retornar os resultados\nreturn {\n    json: {\n        hora: HorarioEnvioMensagem,\n        data: DataEnvioMensagem,\n        timestamp_iso: TimestampISO\n    }\n};\n"
      },
      "id": "11929bca-4a08-454f-bf80-b42169230310",
      "name": "data hora tool",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1136,
        -1120
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=N¬∫ da execu√ß√£o: {{$execution.id}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1392,
        -1120
      ],
      "id": "ae8e8915-5db3-48c3-a1e0-db33c65af240",
      "name": "r tool hub"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "agentes",
        "filters": {
          "conditions": [
            {
              "keyName": "cliente",
              "keyValue": "={{ $('tool hub').first().json.body.instancia }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1008,
        -1120
      ],
      "id": "07045784-3b78-4015-a53a-1d62d5b03f03",
      "name": "puxa agente",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "660c5b13-ba80-44a0-8c13-505f4a0bb14c",
              "leftValue": "={{ $('tool hub').first().json.body.crm }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            },
            {
              "id": "d7101dc9-1f7f-43f9-b690-805f166fb145",
              "leftValue": "={{ $('tool hub').first().json.body.crm }}",
              "rightValue": "=vazio",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "797a8512-c8b8-436b-8088-8429bd6ebe67",
              "leftValue": "={{ $('tool hub').first().json.body.crm }}",
              "rightValue": "crm_",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -480,
        -1120
      ],
      "id": "83223203-74de-481f-9a3a-36cdd9b563f9",
      "name": "crm"
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $json.body.sessionid }}"
            },
            {
              "key": "instancia",
              "value": "={{ $json.body.instancia }}"
            },
            {
              "key": "ferramenta",
              "value": "={{ $json.body.ferramenta }}"
            },
            {
              "key": "crm",
              "value": "={{ $json.body.crm }}"
            },
            {
              "key": "chamada",
              "value": "tools"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -1264,
        -1120
      ],
      "id": "d47ea69b-7f2d-48a9-8571-ed338e525035",
      "name": "execucao"
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $json.body.Instancia }}"
            },
            {
              "key": "whatsapp",
              "value": "={{ $json.body.SessionID }}"
            },
            {
              "key": "horario",
              "value": "={{ $json.body.horario_confirmado_iso }}"
            },
            {
              "key": "chamada",
              "value": "criar_evento"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -4240,
        -1536
      ],
      "id": "d8cd9d90-1e60-4d8e-a337-37e39af9e87b",
      "name": "execucao1"
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $json.body.Instancia }}"
            },
            {
              "key": "whatsapp",
              "value": "={{ $json.body.SessionID }}"
            },
            {
              "key": "data",
              "value": "={{ $json.body.data }}"
            },
            {
              "key": "horario",
              "value": "={{ $json.body.horario }}"
            },
            {
              "key": "tipo",
              "value": "={{ $json.body.tipo_de_busca }}"
            },
            {
              "key": "chamada",
              "value": "gerenciar_agenda"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -4208,
        -1936
      ],
      "id": "2d1d92af-e1e2-4366-ad0c-ee2402579645",
      "name": "execucao2"
    },
    {
      "parameters": {
        "jsCode": "// =========================================================================\n// VERS√ÉO OTIMIZADA E CORRIGIDA do \"Calculador de Blocos Livres\"\n// - Remove eventos duplicados do input.\n// - Implementa a regra `buffer_futuro_horas`.\n// - Otimiza a l√≥gica de loop para maior efici√™ncia.\n// =========================================================================\n\n// =========================================================================\n// 1. SETUP\n// =========================================================================\nconst input = items[0].json.contexto_agenda;\nconst dataAlvoStr = $('entenda data').first().json.output.data_alvo;\n\nconst regras = input.regras;\nconst eventosOcupadosISO = input.eventos_ocupados;\nconst timezone = 'America/Sao_Paulo';\nconst duracaoMin = regras.duracao_minutos;\nconst agora = $now.toJSDate();\n\n// --- FUN√á√ïES AUXILIARES DE FUSO HOR√ÅRIO (Sem altera√ß√µes) ---\nconst getTzOffsetMinutes = (date, tz) => {\n  const dtf = new Intl.DateTimeFormat('en-US', {\n    timeZone: tz,\n    year: 'numeric', month: '2-digit', day: '2-digit',\n    hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false\n  });\n  const parts = dtf.formatToParts(date).reduce((acc, p) => { acc[p.type] = p.value; return acc; }, {});\n  const localTimeAsUTC = Date.UTC(\n    Number(parts.year), Number(parts.month) - 1, Number(parts.day),\n    Number(parts.hour), Number(parts.minute), Number(parts.second)\n  );\n  return Math.round((localTimeAsUTC - date.getTime()) / 60000);\n};\n\nconst createDateInTz = (year, month, day, hour, minute, tz) => {\n  const refDate = new Date(Date.UTC(year, month - 1, day));\n  const offsetMin = getTzOffsetMinutes(refDate, tz);\n  const utcMillis = Date.UTC(year, month - 1, day, hour, minute, 0, 0) - offsetMin * 60000;\n  return new Date(utcMillis);\n};\n\nconst getYMDinTz = (date, tz) => {\n  const parts = new Intl.DateTimeFormat('en-CA', {\n    timeZone: tz, year: 'numeric', month: '2-digit', day: '2-digit'\n  }).formatToParts(date).reduce((a, p) => { a[p.type] = p.value; return a; }, {});\n  return { Y: Number(parts.year), M: Number(parts.month), D: Number(parts.day) };\n};\n\nconst toISOStringWithOffset = (date, tz) => {\n  const parts = new Intl.DateTimeFormat('en-CA', {\n    timeZone: tz, year: 'numeric', month: '2-digit', day: '2-digit',\n    hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false\n  }).formatToParts(date).reduce((a, p) => { a[p.type] = p.value; return a; }, {});\n  const offMin = getTzOffsetMinutes(date, tz);\n  const sign = offMin >= 0 ? '+' : '-';\n  const absMin = Math.abs(offMin);\n  const hh = String(Math.floor(absMin / 60)).padStart(2, '0');\n  const mm = String(absMin % 60).padStart(2, '0');\n  return `${parts.year}-${parts.month}-${parts.day}T${parts.hour}:${parts.minute}:${parts.second}${sign}${hh}:${mm}`;\n};\n\n\n// --- MELHORIA: Remove eventos duplicados do input ---\nconst eventosOcupadosUnicosISO = [...new Set(eventosOcupadosISO)];\n\nconst eventosOcupados = eventosOcupadosUnicosISO.map(isoString => {\n  const start = new Date(isoString);\n  const end = new Date(start.getTime() + duracaoMin * 60000);\n  return { start, end };\n}).sort((a, b) => a.start.getTime() - b.start.getTime());\n\n\n// =========================================================================\n// 2. L√ìGICA PRINCIPAL DE C√ÅLCULO DOS BLOCOS\n// =========================================================================\n\nconst blocosLivres = [];\nconst diasParaVerificar = 7;\nconst dataDePartida = dataAlvoStr ? new Date(dataAlvoStr) : agora;\n\nfor (let i = 0; i < diasParaVerificar; i++) {\n  const diaBase = new Date(dataDePartida);\n  diaBase.setDate(dataDePartida.getDate() + i);\n  const { Y, M, D } = getYMDinTz(diaBase, timezone);\n  const diaDaSemana = createDateInTz(Y, M, D, 12, 0, timezone).getDay();\n  const regraDoDia = regras.dias_uteis.find(d => d.dia_semana === diaDaSemana);\n  if (!regraDoDia) continue;\n\n  const inicioDoDiaTz = createDateInTz(Y, M, D, 0, 0, timezone);\n  const fimDoDiaTz = createDateInTz(Y, M, D, 23, 59, timezone);\n  const ocupadosDoDia = eventosOcupados.filter(e =>\n    e.start >= inicioDoDiaTz && e.start <= fimDoDiaTz\n  );\n\n  for (const periodo of regraDoDia.horarios) {\n    const hIni = Math.floor(periodo.inicio);\n    const mIni = Math.round((periodo.inicio - hIni) * 60);\n    const hFim = Math.floor(periodo.fim);\n    const mFim = Math.round((periodo.fim - hFim) * 60);\n\n    let cursor = createDateInTz(Y, M, D, hIni, mIni, timezone);\n    const fimPeriodo = createDateInTz(Y, M, D, hFim, mFim, timezone);\n\n    // --- OTIMIZA√á√ÉO: Filtra apenas eventos que ocorrem neste per√≠odo de trabalho ---\n    const ocupadosDoPeriodo = ocupadosDoDia.filter(e => e.end > cursor && e.start < fimPeriodo);\n\n    for (const evento of ocupadosDoPeriodo) {\n      if (cursor < evento.start) {\n        const diffMinutes = (evento.start.getTime() - cursor.getTime()) / 60000;\n        if (diffMinutes >= duracaoMin) {\n          blocosLivres.push({ start: cursor, end: evento.start });\n        }\n      }\n      cursor = evento.end > cursor ? evento.end : cursor;\n    }\n\n    if (cursor < fimPeriodo) {\n      const diffMinutes = (fimPeriodo.getTime() - cursor.getTime()) / 60000;\n      if (diffMinutes >= duracaoMin) {\n        blocosLivres.push({ start: cursor, end: fimPeriodo });\n      }\n    }\n  }\n}\n\n// =========================================================================\n// 3. FILTRO FINAL E FORMATA√á√ÉO DA SA√çDA\n// =========================================================================\n\n// --- MELHORIA: Implementa√ß√£o da regra `buffer_futuro_horas` ---\nconst bufferHoras = regras.buffer_futuro_horas || 0;\nconst horarioMinimoParaAgendar = new Date(agora.getTime() + bufferHoras * 60 * 60 * 1000);\n\nconst blocosRealmenteDisponiveis = blocosLivres\n  .map(bloco => {\n    let inicioDisponivel = bloco.start; // Come√ßa com o valor original\n\n    // Verifica se o in√≠cio do bloco est√° dentro do buffer de tempo\n    if (inicioDisponivel.getTime() < horarioMinimoParaAgendar.getTime()) {\n      const intervaloMs = duracaoMin * 60 * 1000;\n      const tempoMinimoMs = horarioMinimoParaAgendar.getTime();\n      \n      // Arredonda o tempo para CIMA para o pr√≥ximo slot v√°lido (ex: 13:12 -> 14:00)\n      const inicioArredondadoMs = Math.ceil(tempoMinimoMs / intervaloMs) * intervaloMs;\n      \n      // Atualiza o in√≠cio para o novo valor arredondado\n      inicioDisponivel = new Date(inicioArredondadoMs);\n    }\n    \n    return { start: inicioDisponivel, end: bloco.end };\n  })\n  .filter(bloco => {\n    // Garante que o bloco final (ap√≥s ajuste do buffer) ainda tenha a dura√ß√£o m√≠nima.\n    const diffMinutes = (bloco.end.getTime() - bloco.start.getTime()) / 60000;\n    return diffMinutes >= duracaoMin;\n  });\n\n// =========================================================================\n// 4. L√ìGICA ADICIONAL PARA SUGEST√ïES DE MANH√É E TARDE (Sem altera√ß√µes)\n// =========================================================================\n\nlet sugestaoManha = null;\nlet sugestaoTarde = null;\n\nconst getHourInTz = (date, tz) => {\n    const hourStr = new Intl.DateTimeFormat('en-US', {\n        timeZone: tz,\n        hour: '2-digit',\n        hour12: false\n    }).format(date);\n    return parseInt(hourStr.replace('24', '0'), 10);\n};\n\nfor (const bloco of blocosRealmenteDisponiveis) {\n    if (sugestaoManha && sugestaoTarde) break;\n\n    let slotCandidato = new Date(bloco.start.getTime());\n\n    while (slotCandidato.getTime() + duracaoMin * 60000 <= bloco.end.getTime()) {\n        const horaLocal = getHourInTz(slotCandidato, timezone);\n\n        if (!sugestaoManha && horaLocal < 12) {\n            sugestaoManha = new Date(slotCandidato.getTime());\n        }\n\n        if (!sugestaoTarde && horaLocal >= 12) {\n            sugestaoTarde = new Date(slotCandidato.getTime());\n        }\n\n        if (sugestaoManha && sugestaoTarde) break;\n\n        slotCandidato.setTime(slotCandidato.getTime() + duracaoMin * 60000);\n    }\n}\n\n// =========================================================================\n// 5. RETORNO FINAL (Sem altera√ß√µes)\n// =========================================================================\n\nreturn [{\n  json: {\n    blocos_livres: blocosRealmenteDisponiveis.map(bloco => ({\n      start: toISOStringWithOffset(bloco.start, timezone),\n      end: toISOStringWithOffset(bloco.end, timezone)\n    })),\n    primeiro_horario_manha: sugestaoManha ? toISOStringWithOffset(sugestaoManha, timezone) : null,\n    primeiro_horario_tarde: sugestaoTarde ? toISOStringWithOffset(sugestaoTarde, timezone) : null,\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2816,
        -1936
      ],
      "id": "ab38fde9-6ff6-4c41-8fd7-af1d700d5828",
      "name": "blocos livres"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"data_alvo\": \n    \"2025-10-06\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4048,
        -1856
      ],
      "id": "80260168-6bde-4699-87e5-5ee64d9d1ee0",
      "name": "parser2"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "calendarId": {
          "__rl": true,
          "value": "490aba053d46ca104b5c75535829ac9039489d637fba39d713dc84a12c8a00bc@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "KRUGER Atendimento IA "
        },
        "triggerOn": "eventCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTrigger",
      "typeVersion": 1,
      "position": [
        -2720,
        -1280
      ],
      "id": "caf02721-dac5-429f-9234-fdfbaab04496",
      "name": "novo evento",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "SiBx2sbnugOWgOZH",
          "name": "[KRUGER] Calendar"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "calendarId": {
          "__rl": true,
          "value": "490aba053d46ca104b5c75535829ac9039489d637fba39d713dc84a12c8a00bc@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "KRUGER Atendimento IA "
        },
        "triggerOn": "eventCancelled",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTrigger",
      "typeVersion": 1,
      "position": [
        -3488,
        -944
      ],
      "id": "40e19221-e7c6-47f9-a2a9-365dae17517f",
      "name": "cancelar evento",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "SiBx2sbnugOWgOZH",
          "name": "[KRUGER] Calendar"
        }
      }
    },
    {
      "parameters": {
        "content": "# TOOLS",
        "height": 99,
        "width": 625,
        "color": 5
      },
      "id": "dce8a74a-1ab7-4a12-b923-346c9a6328da",
      "name": "Sticky Note30",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1648,
        -1424
      ]
    },
    {
      "parameters": {
        "content": "# TOOLS",
        "height": 1577,
        "width": 2553,
        "color": 7
      },
      "id": "7bb592b0-040a-41ba-835d-b9327b69a09f",
      "name": "Sticky Note31",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1648,
        -1296
      ]
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $('novo evento').first().json.organizer.displayName.split(' ')[0] }}"
            },
            {
              "key": "chamada",
              "value": "novo_evento_gcalendar"
            },
            {
              "key": "sumario",
              "value": "={{ $json.summary }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -2560,
        -1280
      ],
      "id": "bd7e5fb0-a854-4fa5-bb60-145beb0b0f3a",
      "name": "execucao4"
    },
    {
      "parameters": {
        "jsCode": "// Obter os dados de entrada (assumindo que est√£o no campo 'datetime')\nlet inputString = $now.toString(); // Garantir que √© uma string\n\n// Fun√ß√£o para retornar os 10 primeiros caracteres (data)\nfunction FirstTen(input) {\n    return input.substring(0, 10);\n}\n\n// Fun√ß√£o para formatar a data no formato DIA/M√äS/ANO\nfunction FormatDateToDMY(input) {\n    const [year, month, day] = input.split('-');\n    return `${day}/${month}/${year}`;\n}\n\n// Fun√ß√£o para retornar os caracteres de 11 a 19 (hora)\nfunction ElevenToNineteen(input) {\n    return input.substring(11, 19);\n}\n\n// Fun√ß√£o para gerar timestamp ISO (at√© os segundos)\nfunction GetTimestampISO(input) {\n    return input.substring(0, 19);\n}\n\n// Manter os 19 primeiros caracteres\nconst HorarioEnvioMensagem = ElevenToNineteen(inputString);\nconst DataEnvioMensagem = FormatDateToDMY(FirstTen(inputString));\nconst TimestampISO = GetTimestampISO(inputString);\n\n// Retornar os resultados\nreturn {\n    json: {\n        horario_envio_mensagem: HorarioEnvioMensagem,\n        data_envio_mensagem: DataEnvioMensagem,\n        timestamp_iso: TimestampISO\n    }\n};\n"
      },
      "id": "a3a042bf-5f5d-4b07-959e-a4485550f2ec",
      "name": "data hora calendar1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3136,
        -944
      ]
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $('cancelar evento').first().json.organizer.displayName.split(' ')[0] }}"
            },
            {
              "key": "chamada",
              "value": "cancelar_evento_gcalendar"
            },
            {
              "key": "sumario",
              "value": "={{ $json.summary }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -3280,
        -944
      ],
      "id": "1893fc27-2b0e-43c5-a975-ed3023355145",
      "name": "execucao5"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('cancelar evento').first().json.organizer.displayName.toLowerCase().split(' ')[0] }}_sdr_agendamentos",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "calendar_id",
              "condition": "eq",
              "keyValue": "={{ $('cancelar evento').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status_agendamento",
              "fieldValue": "Cancelado"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2992,
        -944
      ],
      "id": "cde62947-b93b-479a-b946-ffc9a08c0e0e",
      "name": "atualiza evento",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sdrtoolapagareventokruger",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "14182eb8-36fc-43ca-881b-838bceec1bda",
      "name": "apaga evento",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -4416,
        -928
      ],
      "webhookId": "ace9234e-1844-4f6e-a0e3-a59ea40e98ba"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=Evento apagado com sucesso. {{$execution.id}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -3776,
        -928
      ],
      "id": "9741fd18-8112-4f39-a6f0-27169befd155",
      "name": "r apaga evento"
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $json.body.Instancia }}"
            },
            {
              "key": "chamada",
              "value": "cancelar_evento"
            },
            {
              "key": "whatsapp",
              "value": "={{ $json.body.SessionID }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -4224,
        -928
      ],
      "id": "161d6e90-0583-402f-ae2d-865c97b661c7",
      "name": "execucao6"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('apaga evento').first().json.body.Instancia.toLowerCase() }}_sdr_agendamentos",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $('apaga evento').first().json.body.SessionID }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -4080,
        -928
      ],
      "id": "35486656-d2ff-48c5-8dcb-5c1df032e1b5",
      "name": "puxa evento",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('apaga evento').first().json.body.Instancia.toLowerCase() }}_sdr_agendamentos",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status_agendamento",
              "fieldValue": "Cancelado"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3936,
        -928
      ],
      "id": "e88fda5f-cac4-4259-83f5-1f915219fa27",
      "name": "cancela evento",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('criar evento').first().json.body.Instancia.toLowerCase()  }}_sdr_agendamentos",
        "filters": {
          "conditions": [
            {
              "keyName": "data_inicio_evento",
              "keyValue": "={{ $('formata horarios').first().json.start }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -3328,
        -1536
      ],
      "id": "5d5fa0a3-4b29-4fc7-9483-2d6d471eca84",
      "name": "puxa agenda",
      "alwaysOutputData": true,
      "executeOnce": false,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7b66f10c-de16-4725-b1c4-982cc42c5d1b",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            },
            {
              "id": "3b9688b2-846e-4121-a9f0-9b0d35b353df",
              "leftValue": "={{ $json.status_agendamento }}",
              "rightValue": "Cancelado",
              "operator": {
                "type": "string",
                "operation": "notContains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3184,
        -1536
      ],
      "id": "af8ca0f4-6152-4c06-8131-f8134c65dae8",
      "name": "agenda ocupada"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=Evento impossibilitado de ser agendado. Hor√°rio indispon√≠vel, por favor escolher outro. {{$execution.id}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -3024,
        -1536
      ],
      "id": "282ed1f2-43d0-4ac9-994e-df1488ae9cb0",
      "name": "evento ocupado"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens que sa√≠ram do n√≥ chamado 'reagendar'.\n// O resultado ser√° uma lista (array).\nconst itemsDoReagendar = $('reagendar').all();\n\n// Define a vari√°vel 'status' usando uma condi√ß√£o tern√°ria (um if/else de uma linha).\n// Se o n√∫mero de itens na lista for 0 (vazio), o status √© 'Confirmado'.\n// Sen√£o (se a lista tiver um ou mais itens), o status √© 'Reagendado'.\nconst status = itemsDoReagendar.length === 0 ? 'Confirmado' : 'Reagendado';\n\n// Retorna o resultado no formato padr√£o do n8n.\n// Isso ir√° criar um novo item com um campo chamado 'status' contendo o valor que definimos.\nreturn [{\n  json: {\n    status: status\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3488,
        -1312
      ],
      "id": "c91feefb-d873-4e94-8e70-7c26a4a7dc77",
      "name": "status"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('campos documento').first().json.instancia.toLowerCase() }}_sdr_leads",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "condition": "eq",
              "keyValue": "={{ $('formata telefone3').first().json.TelefoneSem9 }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "estado_atual",
              "fieldValue": "RECEPCAO_ESCRITORIO"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1008,
        -912
      ],
      "id": "e56596a6-d4f0-4df2-8357-84b24f52b684",
      "name": "atualiza matriz",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a7752ec3-f9ec-4ce1-9c95-ae6fba47648e",
              "name": "instancia",
              "value": "KRUEGER",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1184,
        -912
      ],
      "id": "c1b34b9d-0c89-4810-855e-1a35a34aaa2c",
      "name": "campos documento"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "zapsignkruger",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1568,
        -912
      ],
      "id": "bac57b71-c1c4-4481-a6c1-72de4294a8a6",
      "name": "zapsign wh",
      "webhookId": "580027fc-d24f-47df-b3b4-3adbc5baac89"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        448,
        64
      ],
      "id": "d51720a4-f47b-498c-a511-08d237d82634",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "45ac3b63-ad21-4022-87bf-aa18363fc68a",
              "name": "sessionid",
              "value": "=5184036335",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        656,
        64
      ],
      "id": "899cb587-d6e4-4383-9cd2-448a6b36b2c4",
      "name": "dados gerais1"
    },
    {
      "parameters": {
        "content": "## Teste tool\nLembre de mudar o link dados gerais1 para dados gerais",
        "height": 256,
        "width": 480
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        384,
        -32
      ],
      "typeVersion": 1,
      "id": "f4c88c41-e8ef-420c-b0d1-ebb2b03162b7",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 208,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3680,
        -1360
      ],
      "typeVersion": 1,
      "id": "68cc87d5-87a2-4093-94f0-c9ad036683e1",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "# Cuidar tag vermelha\n## √â Personaliza√ß√£o de cliente",
        "width": 368,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4992,
        -880
      ],
      "typeVersion": 1,
      "id": "64a97761-befe-4247-be96-e13d73d31eb4",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 208,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4464,
        -1984
      ],
      "typeVersion": 1,
      "id": "c7232c6d-ece6-4ef4-a1d6-b97b24690009",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 192,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4480,
        -1584
      ],
      "typeVersion": 1,
      "id": "e462eaf8-ab15-4dd9-a720-06a12f8f16dd",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 192,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4464,
        -976
      ],
      "typeVersion": 1,
      "id": "d93801d5-abd2-4656-b2d1-e6b43e09824e",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 176,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1616,
        -1168
      ],
      "typeVersion": 1,
      "id": "26c3a7fa-9580-4204-bf35-f52dbc6cf125",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 176,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1616,
        -960
      ],
      "typeVersion": 1,
      "id": "705bb3d6-4419-44df-b56b-8f5f84a05b0a",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 224,
        "width": 352,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4336,
        -1360
      ],
      "typeVersion": 1,
      "id": "ae26bc8e-d502-4104-832a-8e45b8400c40",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 224,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3536,
        -992
      ],
      "typeVersion": 1,
      "id": "2451a911-b535-4954-9d97-94eae8f2a0da",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 208,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2608,
        -1616
      ],
      "typeVersion": 1,
      "id": "279d3617-0865-4aaa-a648-fe172d0f5b0d",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "data_inicio_evento"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        -3552,
        -1936
      ],
      "id": "9d230f9a-83d1-40bc-b59e-84735902aeda",
      "name": "ordena eventos"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "591414b3-0433-448a-9448-cf27f0a87be2",
              "name": "tool",
              "value": "={{ $('tool hub').first().json.body.tool }}",
              "type": "string"
            },
            {
              "id": "45ac3b63-ad21-4022-87bf-aa18363fc68a",
              "name": "sessionid",
              "value": "={{ $('tool hub').first().json.body.sessionid }}",
              "type": "string"
            },
            {
              "id": "a26cc2d1-a33d-4924-9f59-7484a3345945",
              "name": "instancia",
              "value": "={{ $('tool hub').first().json.body.instancia }}",
              "type": "string"
            },
            {
              "id": "fee068e5-4061-4821-b4d0-a96e65233dab",
              "name": "nome",
              "value": "={{ $('puxa lead').first().json.nome }}",
              "type": "string"
            },
            {
              "id": "453118d3-acac-4b6d-b1ae-a477fc3499de",
              "name": "email",
              "value": "={{ $('puxa lead').first().json.email }}",
              "type": "string"
            },
            {
              "id": "9fc8b3b5-d92f-4de3-8cd1-f3562e3990bb",
              "name": "crm_status",
              "value": "={{ $('puxa lead').first().json.crm_status }}",
              "type": "string"
            },
            {
              "id": "e3442149-08ba-481d-be21-aa04c7ad42ee",
              "name": "estado_atual",
              "value": "={{ $('puxa lead').first().json.estado_atual }}",
              "type": "string"
            },
            {
              "id": "45d699eb-b0ec-4750-99eb-b6e1666ffa53",
              "name": "telefone_tratado_datacrazy",
              "value": "={{ $json.numero }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -608,
        -1120
      ],
      "id": "e29f32ce-3c52-473d-8f96-e86214604dde",
      "name": "dados gerais"
    },
    {
      "parameters": {
        "jsCode": "// Loop sobre os itens de entrada para formatar o n√∫mero de telefone\nfor (const item of $input.all()) {\n  // Pega o n√∫mero de telefone original do campo 'whatsapp'\n  const originalPhoneNumber = item.json.whatsapp;\n\n  // Garante que o n√∫mero de telefone seja uma string antes de manipular\n  if ((typeof originalPhoneNumber === 'string' || typeof originalPhoneNumber === 'number') && originalPhoneNumber.toString().length > 0) {\n    // Converte para string e remove todos os caracteres que n√£o s√£o d√≠gitos\n    let apenasNumeros = originalPhoneNumber.toString().replace(/\\D/g, '');\n\n    // Remove o c√≥digo do pa√≠s '55' se estiver no in√≠cio\n    if (apenasNumeros.startsWith('55')) {\n      apenasNumeros = apenasNumeros.substring(2);\n    }\n\n    // Extrai DDD e n√∫mero local\n    const ddd = apenasNumeros.substring(0, 2);\n    const numeroLocalOriginal = apenasNumeros.substring(2); // preservado (8 ou 9 d√≠gitos)\n\n    // Vers√£o SEM o nono d√≠gito (para usar nos outros formatos)\n    let numeroLocalSem9 = numeroLocalOriginal;\n    if (numeroLocalSem9.length === 9 && numeroLocalSem9.startsWith('9')) {\n      numeroLocalSem9 = numeroLocalSem9.substring(1);\n    }\n\n    // 1) DDD + n√∫mero (sem 9)\n    const numeroFormatado = ddd + numeroLocalSem9;\n    item.json.telefone_formatado = numeroFormatado;\n\n    // 2) +55 (DD) 9XXXX-XXXX (sempre com 9)\n    const parte1 = numeroFormatado.substring(0, 2); // DDD\n    const parte2 = numeroFormatado.substring(2, 6); // primeiros 4 d√≠gitos\n    const parte3 = numeroFormatado.substring(6);    // √∫ltimos 4 d√≠gitos\n    const numeroComSimbolos = `+55 (${parte1}) 9${parte2}-${parte3}`;\n    item.json.numerocomsimbolos = numeroComSimbolos;\n\n    // 3) Apenas o n√∫mero local, sem DDD, preservando 8 ou 9 d√≠gitos (N√ÉO adiciona 9)\n    item.json.numero = numeroLocalOriginal;\n  }\n}\n\n// Retorna os dados com os novos campos\nreturn $input.all();\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -752,
        -1120
      ],
      "id": "c0bd4d27-268e-4aa6-b7f6-595e4e9847c9",
      "name": "formata telefone"
    },
    {
      "parameters": {
        "content": "# Vers√£o 1.0.0",
        "height": 80,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2000,
        -784
      ],
      "typeVersion": 1,
      "id": "b8866594-a3ee-4c71-b5ed-063269af7a30",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "content": "# Vers√£o 1.2.0",
        "height": 80,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1600,
        128
      ],
      "typeVersion": 1,
      "id": "f8629857-c7ec-4af8-996a-ea18997fb75e",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "content": "",
        "height": 176,
        "width": 182,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1232,
        -928
      ],
      "typeVersion": 1,
      "id": "393e1304-0034-4373-8c13-f4445d731818",
      "name": "Sticky Note32"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d2c87bb0-03bb-4bd8-8fd3-c168a378ab50",
                    "leftValue": "={{ $('dados gerais').first().json.tool }}",
                    "rightValue": "descarte",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "descarte"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0e961239-32ee-4793-9824-572eabe3dfef",
                    "leftValue": "={{ $('dados gerais').first().json.tool }}",
                    "rightValue": "erro",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "erro"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5a9e22e3-4ab9-4ed0-97f6-a5c840eeaf44",
                    "leftValue": "={{ $('dados gerais').first().json.tool }}",
                    "rightValue": "contrato",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "contrato"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "08fee071-9385-46e9-abb3-e005439052ac",
                    "leftValue": "={{ $('dados gerais').first().json.tool }}",
                    "rightValue": "datacrazy_qualificado",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "datacrazy_qualificado"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "182520e9-5ae1-4b13-b1fa-d100da1e6593",
                    "leftValue": "={{ $('dados gerais').first().json.tool }}",
                    "rightValue": "datacrazy_reuniao_agendada",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "datacrazy_reuniao_agendada"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ac7ceb5c-a3ed-4887-a69b-c13c719cbcc8",
                    "leftValue": "={{ $('dados gerais').first().json.tool }}",
                    "rightValue": "datacrazy_perdidos",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "datacrazy_perdidos"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0903576f-9683-469c-8266-99c98c646c71",
                    "leftValue": "={{ $('dados gerais').first().json.tool }}",
                    "rightValue": "datacrazy_em_contato",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "datacrazy_em_contato"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -288,
        -1104
      ],
      "id": "7b9bfc7e-9442-42a0-ba2a-8e3c78a680d0",
      "name": "seleciona tool"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('tool hub').first().json.body.instancia.toLowerCase() }}_sdr_leads",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('puxa lead').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "crm",
              "fieldValue": "={{ $('tool hub').first().json.body.crm.toUpperCase().slice(4) }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -16,
        -1232
      ],
      "id": "297a19bb-c66a-420b-b115-8156d94b588d",
      "name": "atualiza crm",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('tool hub').first().json.body.instancia.toLowerCase() }}_sdr_leads",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('puxa lead').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "fluxo_followup",
              "fieldValue": "={{ $('tool hub').first().json.body.crm.toUpperCase().slice(4) }}"
            },
            {
              "fieldId": "ultimo_fup",
              "fieldValue": "0"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        128,
        -1232
      ],
      "id": "2d4f419f-d959-4a36-8a76-be2144d8c85c",
      "name": "atualiza fups",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('tool hub').first().json.body.instancia.toLowerCase() }}_sdr_leads",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('puxa lead').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "off"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        480,
        -1232
      ],
      "id": "3513a248-43d9-4291-a63a-e2acfe3357c1",
      "name": "descarta",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.zapsign.com.br/api/v1/models/create-doc/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('puxa agente').first().json.api_zapsign }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n\t\"template_id\":\"{{ $('puxa agente').first().json.modelo_zapsign }}\",\n\t\"signer_name\":\"{{ $('dados contrato').first().json.nome_completo }}\",\n    \"signer_phone_number\":\"{{ $('formata telefone').first().json.numerocomsimbolos.substring(4) }}\",\n\t\"send_automatic_email\": false,\n\t\"send_automatic_whatsapp\": false,\n\t\"lang\": \"pt-br\",\n\t\"external_id\": null,\n\t\"data\":[\n        {\n            \"de\":\"{{ $json.nome }}\",\n            \"para\":\"{{ $('dados contrato').first().json.nome_completo }}\"\n        },\n        {\n            \"de\":\"{{ $json.cpf }}\",\n            \"para\":\"{{ $('dados contrato').first().json.cpf }}\"\n        },\n        {\n            \"de\":\"{{ $json.estado_civil }}\",\n            \"para\":\"{{ $('dados contrato').first().json.estado_civil }}\"\n        },\n        {\n            \"de\":\"{{ $json.profissao }}\",\n            \"para\":\"{{ $('dados contrato').first().json.profissao }}\"\n        },\n        {\n            \"de\":\"{{ $json.endereco_completo }}\",\n            \"para\":\"{{ $('dados contrato').first().json.endereco_completo }}\"\n        },\n        {\n            \"de\":\"{{ $json.data }}\",\n            \"para\":\"{{ $('data hora tool').first().json.data }}\"\n        }\n      \n    ]\n}\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        480,
        -944
      ],
      "id": "8b189e64-a796-4443-b074-4e9ba9076dc9",
      "name": "zapsign"
    },
    {
      "parameters": {
        "amount": 40
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        624,
        -944
      ],
      "id": "f82cc251-0c8c-4037-8f2e-ef2ce3e7c81b",
      "name": "aguarda",
      "webhookId": "e4275542-e3e9-4bee-a910-7e961b88d5f5"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.eduardofischborn.com.br/message/sendText/{{ $('tool hub').first().json.body.instancia }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=55{{ $('puxa lead').first().json.whatsapp }}"
            },
            {
              "name": "text",
              "value": "={{ $('zapsign').first().json.signers[0].sign_url }}"
            },
            {
              "name": "presence",
              "value": "composing"
            },
            {
              "name": "linkPreview",
              "value": "={{ false }}"
            },
            {
              "name": "delay",
              "value": "={{ 2500 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8991c6ee-1127-42df-b169-48530991a0b6",
      "name": "envia link contrato",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        768,
        -944
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "rPARANITH2QYrjl5",
          "name": "[1] EVOLUTION"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0a3d70a1-89ee-4e1b-a8a1-93e4ebbbd74d",
              "name": "nome",
              "value": "{{nome_completo}}",
              "type": "string"
            },
            {
              "id": "787f6104-167f-45d7-81b5-61e1e6c0d712",
              "name": "cpf",
              "value": "{{cpf}}",
              "type": "string"
            },
            {
              "id": "5298f161-88fc-4953-9d68-82159e3c16ea",
              "name": "estado_civil",
              "value": "{{estado_civil}}",
              "type": "string"
            },
            {
              "id": "3b5d7169-436e-42b2-9353-8b2d155d801f",
              "name": "profissao",
              "value": "{{profissao}}",
              "type": "string"
            },
            {
              "id": "f26de2ab-a396-4a9e-98cd-7577624bec8d",
              "name": "endereco_completo",
              "value": "{{endereco_completo}}",
              "type": "string"
            },
            {
              "id": "f7328279-2aa2-44d6-b6d4-6dd2ed59aaea",
              "name": "data",
              "value": "{{data}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        336,
        -944
      ],
      "id": "b9d8d119-47be-4b2a-aa58-a1989d607544",
      "name": "campos contrato"
    },
    {
      "parameters": {
        "jsCode": "// Acessa a vari√°vel \"dados\" do JSON\nconst dadosString = $('puxa lead').first().json.dados;\n\n// Inicia um objeto vazio para armazenar os resultados\nconst resultado = {};\n\n// Acessa a vari√°vel \"dados_cliente_serializados\" dentro do JSON 'dados'\ntry {\n  // Converte a string 'dados' em um objeto JSON\n  const dados = JSON.parse(dadosString);\n\n  // Acessa a string de dados serializados\n  const serializadosString = dados.dados_cliente_serializados;\n\n  // Converte a string serializada em um objeto JSON\n  const serializados = JSON.parse(serializadosString);\n\n  // Itera sobre as chaves (nomes dos par√¢metros) do objeto 'serializados'\n  for (const key in serializados) {\n    // Verifica se a chave pertence ao objeto e n√£o √© herdada\n    if (Object.prototype.hasOwnProperty.call(serializados, key)) {\n      // Adiciona o par chave-valor ao objeto 'resultado'\n      // O valor da chave ser√° a string formatada \"{{parametro}}\"\n      resultado[`${key}`] = serializados[key];\n    }\n  }\n\n} catch (e) {\n  // Em caso de erro (por exemplo, JSON mal formatado), imprime a mensagem de erro no console\n  console.error(\"Erro ao processar o JSON:\", e);\n}\n\n// Retorna o objeto de resultados encapsulado em um array, pois o n8n espera uma lista de objetos.\n// O n8n processa cada item de uma lista, ent√£o para ter um √∫nico item na sa√≠da, retornamos uma lista com um √∫nico item (nosso objeto \"resultado\").\nreturn [resultado];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        -944
      ],
      "id": "235d48de-68a7-4427-b752-3b3e038c7a05",
      "name": "dados contrato"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.eduardofischborn.com.br/message/sendText/{{ $('tool hub').first().json.body.instancia }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=55{{ $('puxa agente').first().json.telefone_avisos }}"
            },
            {
              "name": "text",
              "value": "=üìà | **NOVO CONTRATO** |\n\nüìÖ  *Data: {{ $('data hora tool').first().json.data }} √†s {{ $('data hora tool').first().json.hora }}*\n‚Ä¢ `Whatsapp` - {{ $('dados gerais').first().json.sessionid }}\n\n\nüí¨  *Link:*\n{{ $('zapsign').first().json.signers[0].sign_url }}"
            },
            {
              "name": "presence",
              "value": "composing"
            },
            {
              "name": "linkPreview",
              "value": "={{ false }}"
            },
            {
              "name": "delay",
              "value": "={{ 2500 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "68852495-ed29-4744-8bdb-5debb8e4d398",
      "name": "avisa envio contrato",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        928,
        -944
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "rPARANITH2QYrjl5",
          "name": "[1] EVOLUTION"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/leads/{{ $json.data[0].id }}/businesses",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1168,
        -624
      ],
      "id": "4a60af08-7504-4ebc-b3ac-12d90c2e0d16",
      "name": "neg√≥cios do lead1"
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.data[0].id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1328,
        -624
      ],
      "id": "a20c8051-3e17-4aba-bd04-254da718119e",
      "name": "puxa dados neg√≥cio1"
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/leads/{{ $json.data[0].id }}/businesses",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1168,
        -448
      ],
      "id": "3108550b-5e60-4670-8143-43e43bf5100b",
      "name": "neg√≥cios do lead2"
    },
    {
      "parameters": {
        "url": "https://api.datacrazy.io/v1/api/api/v1/leads",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "search",
              "value": "={{ $('dados gerais').item.json.telefone_tratado_datacrazy }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1024,
        -448
      ],
      "id": "526491c5-ebc9-4dbf-af63-a1eb796d97b1",
      "name": "Puxa lead2"
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.data[0].id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1328,
        -448
      ],
      "id": "a1680ed5-992c-4ec1-9ab5-ccb12f005072",
      "name": "puxa dados neg√≥cio2"
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/leads/{{ $json.data[0].id }}/businesses",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1168,
        -784
      ],
      "id": "53f36c10-346c-4be2-865f-b79acb404562",
      "name": "neg√≥cios do lead3"
    },
    {
      "parameters": {
        "url": "https://api.datacrazy.io/v1/api/api/v1/leads",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "search",
              "value": "={{ $('dados gerais').item.json.telefone_tratado_datacrazy }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1024,
        -784
      ],
      "id": "72637126-95f6-49c2-88a3-196723c4599b",
      "name": "Puxa lead3"
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.data[0].id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1328,
        -784
      ],
      "id": "c40e44e8-20f5-4e63-a492-d6d3ebeed4b3",
      "name": "puxa dados neg√≥cio3"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "stageId",
              "value": "b747452c-6da0-4181-b85e-6d36b36ae649"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1488,
        -624
      ],
      "id": "9a61d959-bf9c-4902-927b-67e12127e0b2",
      "name": "move card reuni√£o agendada"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "stageId",
              "value": "0312b04b-41fa-4191-9039-0f432ca7c38a"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1488,
        -448
      ],
      "id": "63c12a34-3407-4702-b7fe-bde33f7cb1ef",
      "name": "move card perididos"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "stageId",
              "value": "2c91bbff-00bd-4972-bc16-f7b0dbe4dca6"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1488,
        -784
      ],
      "id": "a2e1cf2c-aca3-4cfd-994c-214255e82a24",
      "name": "move card qualificados"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "stageId",
              "value": "69935e02-e096-4faa-a0ad-e0a6a2929e96"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1488,
        -272
      ],
      "id": "80f7bf42-2853-4ee6-a0c3-1aac1e18a42b",
      "name": "move card em contato"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 1200,
        "width": 1184,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -320,
        -1264
      ],
      "typeVersion": 1,
      "id": "72fc1002-5ba3-4ed6-b8cb-e92d5d3daf6c",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "url": "https://api.datacrazy.io/v1/api/api/v1/leads",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "search",
              "value": "={{ $('dados gerais').item.json.telefone_tratado_datacrazy }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1024,
        -624
      ],
      "id": "82d467d0-5046-483b-9203-5d5cfef930c7",
      "name": "Puxa lead4"
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/leads/{{ $json.data[0].id }}/businesses",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4Y2IxYWFlODliNGYzYzQxNjkwN2VkMCIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxFWEEiLCJpYXQiOjE3NTgxNDExMDJ9.rYrH4tRvGRP57Lipm4pqFeA9AnQxm8BUA_KO7R2ELJs"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1168,
        -272
      ],
      "id": "56fc457d-8b40-417b-bc41-0eeb9279a01f",
      "name": "neg√≥cios do lead4"
    },
    {
      "parameters": {
        "url": "https://api.datacrazy.io/v1/api/api/v1/leads",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "search",
              "value": "={{ $('dados gerais').item.json.telefone_tratado_datacrazy }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1024,
        -272
      ],
      "id": "a7be5e32-cf2c-494f-b366-c6cf203048b0",
      "name": "Puxa lead5"
    },
    {
      "parameters": {
        "url": "=https://api.datacrazy.io/v1/api/api/v1/businesses/{{ $json.data[0].id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1328,
        -272
      ],
      "id": "5305da52-7ef5-4863-a564-ec819fc3ddd2",
      "name": "puxa dados neg√≥cio4"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 224,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2752,
        -1344
      ],
      "typeVersion": 1,
      "id": "6c7b9424-7ece-44de-acb7-c76007a81448",
      "name": "Sticky Note27"
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 192,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1616,
        -752
      ],
      "typeVersion": 1,
      "id": "d90a8eb4-d030-468b-b80b-a47ec2d3fc20",
      "name": "Sticky Note33"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "datacrazydesligalead-kruger",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1568,
        -704
      ],
      "id": "ce005ed0-7927-4586-8cfd-790fcc033e51",
      "name": "Datacrazy - Desliga IA",
      "webhookId": "2a62fd32-8b1c-47ff-8d43-344d53283d82"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "45ac3b63-ad21-4022-87bf-aa18363fc68a",
              "name": "sessionid",
              "value": "={{ $json.TelefoneSem9 }}",
              "type": "string"
            },
            {
              "id": "a26cc2d1-a33d-4924-9f59-7484a3345945",
              "name": "instancia",
              "value": "={{ $('Datacrazy - Desliga IA').item.json.body.instancia }}",
              "type": "string"
            },
            {
              "id": "8061072a-1219-4c85-9e12-cde82b3ca8b1",
              "name": "estado",
              "value": "={{ $('Datacrazy - Desliga IA').item.json.body.tool }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -992,
        -704
      ],
      "id": "00851bc9-60db-4230-ab0e-095724c0d06f",
      "name": "infos dcz"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "={{ $('infos dcz').item.json.instancia.toLowerCase() }}_sdr_leads",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "condition": "eq",
              "keyValue": "={{ $('infos dcz').item.json.sessionid }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -864,
        -704
      ],
      "id": "4d34e77f-b9b4-4572-ac60-fcebf29b8fe6",
      "name": "puxa rows1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "98434c11-8efa-43d8-a64f-a4a56bda5f36",
              "leftValue": "={{ $json.id }}",
              "rightValue": "=",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -720,
        -704
      ],
      "id": "336f7248-ba76-4721-add1-3819717e7df4",
      "name": "lead existe supabase1"
    },
    {
      "parameters": {
        "tableId": "={{ $('infos dcz').item.json.instancia.toLowerCase() }}_sdr_leads",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "whatsapp",
              "fieldValue": "={{ $('infos dcz').item.json.sessionid }}"
            },
            {
              "fieldId": "estado_atual",
              "fieldValue": "DESCARTE"
            },
            {
              "fieldId": "data",
              "fieldValue": "={{ $('data hora1').item.json.data }}"
            },
            {
              "fieldId": "fluxo_followup",
              "fieldValue": "DESCARTE"
            },
            {
              "fieldId": "status",
              "fieldValue": "off"
            },
            {
              "fieldId": "crm",
              "fieldValue": "DESCARTE"
            },
            {
              "fieldId": "horario",
              "fieldValue": "={{ $('data hora1').item.json.hora }}"
            }
          ]
        }
      },
      "id": "93859996-82fb-4dca-9bce-df85cf9a8bc1",
      "name": "salva lead off",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -544,
        -608
      ],
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('infos dcz').item.json.instancia.toLowerCase() }}_sdr_leads",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "condition": "eq",
              "keyValue": "={{ $('infos dcz').item.json.sessionid }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "off"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -544,
        -768
      ],
      "id": "0d830f85-7995-4c2f-9d28-ac52c9ce1625",
      "name": "Update a row",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const results = [];\n\nfor (const item of $input.all()) {\n  const signer = item.json?.body?.signers?.[0];\n\n  if (!signer?.phone_number) {\n    results.push({ json: { error: 'zapsign wh: body.signers[0].phone_number ausente.' } });\n    continue;\n  }\n\n  const country = String(signer.phone_country ?? '').replace(/\\D/g, '');\n  const localRaw = String(signer.phone_number ?? '').replace(/\\D/g, '');\n\n  let jidOriginalNumerico = localRaw;\n  if (country && !jidOriginalNumerico.startsWith(country)) {\n    jidOriginalNumerico = country + jidOriginalNumerico;\n  }\n\n  let phoneNumber = jidOriginalNumerico;\n  if (phoneNumber.startsWith('5555')) {\n    phoneNumber = phoneNumber.slice(2);\n  } else if (phoneNumber.startsWith('55')) {\n    phoneNumber = phoneNumber.slice(2);\n  }\n\n  const processedPhoneNumber = phoneNumber;\n  const remoteJidFormatado = processedPhoneNumber;\n\n  let TelefoneCom9 = null;\n  let TelefoneSem9 = null;\n\n  if (processedPhoneNumber.length === 10) {\n    TelefoneCom9 = processedPhoneNumber.slice(0, 2) + '9' + processedPhoneNumber.slice(2);\n    TelefoneSem9 = processedPhoneNumber;\n  } else if (processedPhoneNumber.length === 11) {\n    if (processedPhoneNumber.charAt(2) === '9') {\n      TelefoneCom9 = processedPhoneNumber;\n      TelefoneSem9 = processedPhoneNumber.slice(0, 2) + processedPhoneNumber.slice(3);\n    } else {\n      TelefoneCom9 = processedPhoneNumber.slice(0, 2) + '9' + processedPhoneNumber.slice(2);\n      TelefoneSem9 = processedPhoneNumber;\n    }\n  }\n\n  results.push({\n    json: { TelefoneCom9, TelefoneSem9, remoteJidFormatado }\n  });\n}\n\nreturn results;\n"
      },
      "id": "b3857572-51d9-44ee-98dc-bcad1b09f060",
      "name": "formata telefone3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1376,
        -912
      ]
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  // Pega o n√∫mero original a partir do n√≥ \"Datacrazy - Desliga IA\"\n  let numeroOriginal = $('Datacrazy - Desliga IA')\n    .first()\n    .json\n    .body\n    .sessionid?.toString()\n    .replace(/\\D/g, '') || '';\n\n  // --- NOVO OUTPUT ---\n  // Cria o terceiro output removendo os 2 primeiros d√≠gitos do n√∫mero (caso ele comece com 55)\n  const numeroFormatado = numeroOriginal.startsWith('55')\n    ? numeroOriginal.slice(2)\n    : numeroOriginal;\n\n  // --- L√ìGICA EXISTENTE (INALTERADA) ---\n  let phoneNumber = numeroOriginal;\n\n  if (phoneNumber.startsWith('5555')) {\n    phoneNumber = phoneNumber.slice(2);\n  } else if (phoneNumber.startsWith('55')) {\n    phoneNumber = phoneNumber.slice(2);\n  }\n\n  const processedPhoneNumber = phoneNumber;\n\n  let TelefoneCom9 = null;\n  let TelefoneSem9 = null;\n\n  if (processedPhoneNumber.length === 10) {\n    // n√∫mero sem o 9 ‚Üí adiciona\n    TelefoneCom9 = processedPhoneNumber.slice(0, 2) + '9' + processedPhoneNumber.slice(2);\n    TelefoneSem9 = processedPhoneNumber;\n  } else if (processedPhoneNumber.length === 11) {\n    if (processedPhoneNumber.charAt(2) === '9') {\n      // n√∫mero j√° tem o 9 ‚Üí remove para gerar a vers√£o sem 9\n      TelefoneCom9 = processedPhoneNumber;\n      TelefoneSem9 = processedPhoneNumber.slice(0, 2) + processedPhoneNumber.slice(3);\n    } else {\n      // fallback ‚Äî adiciona o 9\n      TelefoneCom9 = processedPhoneNumber.slice(0, 2) + '9' + processedPhoneNumber.slice(2);\n      TelefoneSem9 = processedPhoneNumber;\n    }\n  }\n\n  // --- RETORNO ---\n  return {\n    json: {\n      TelefoneCom9,\n      TelefoneSem9,\n      numeroFormatado\n    }\n  };\n}\n"
      },
      "id": "3ea68891-d3be-4de8-9902-e7279ccdc101",
      "name": "formata telefone1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1120,
        -704
      ]
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $json.body.sessionid }}"
            },
            {
              "key": "instancia",
              "value": "={{ $json.body.instancia }}"
            },
            {
              "key": "chamada",
              "value": "tools"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -1376,
        -704
      ],
      "id": "0a5c8992-5153-4b82-9a95-7ab54b8dddbe",
      "name": "execucao7"
    },
    {
      "parameters": {
        "jsCode": "// Obter os dados de entrada (assumindo que est√£o no campo 'datetime')\nlet inputString = $now.toString(); // Garantir que √© uma string\n\n// Fun√ß√£o para retornar os 10 primeiros caracteres (data)\nfunction FirstTen(input) {\n    return input.substring(0, 10);\n}\n\n// Fun√ß√£o para formatar a data no formato DIA/M√äS/ANO\nfunction FormatDateToDMY(input) {\n    const [year, month, day] = input.split('-');\n    return `${day}/${month}/${year}`;\n}\n\n// Fun√ß√£o para retornar os caracteres de 11 a 19 (hora)\nfunction ElevenToNineteen(input) {\n    return input.substring(11, 19);\n}\n\n// Fun√ß√£o para gerar timestamp ISO (at√© os segundos)\nfunction GetTimestampISO(input) {\n    return input.substring(0, 19);\n}\n\n// Manter os 19 primeiros caracteres\nconst HorarioEnvioMensagem = ElevenToNineteen(inputString);\nconst DataEnvioMensagem = FormatDateToDMY(FirstTen(inputString));\nconst TimestampISO = GetTimestampISO(inputString);\n\n// Retornar os resultados\nreturn {\n    json: {\n        hora: HorarioEnvioMensagem,\n        data: DataEnvioMensagem,\n        timestamp_iso: TimestampISO\n    }\n};\n"
      },
      "id": "7707865f-7ece-4c57-86fc-ebf17ff1477e",
      "name": "data hora1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1248,
        -704
      ]
    },
    {
      "parameters": {
        "content": "# LEMBRETES",
        "height": 585,
        "width": 2233,
        "color": 7
      },
      "id": "e19eced2-c8a0-456f-85df-36a4c164d4dd",
      "name": "Sticky Note28",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1648,
        -2208
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('puxa lembrete').first().json.tipo_midia }}",
                    "rightValue": "=texto",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "0b6f48fa-b803-4457-9d86-a98eddad977a"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dd7499d0-b64c-47be-b1aa-2e9164717de2",
                    "leftValue": "={{ $('puxa lembrete').first().json.tipo_midia }}",
                    "rightValue": "imagem",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "imagem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "20cf91f1-d1c1-4f50-be97-73e103b23f80",
                    "leftValue": "={{ $('puxa lembrete').first().json.tipo_midia }}",
                    "rightValue": "√°udio",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "√°udio"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -416,
        -1936
      ],
      "id": "0d13c4a4-f99d-4628-a898-e44a7df086d5",
      "name": "tipo midia"
    },
    {
      "parameters": {
        "amount": "={{ $json.distanciaEmMinutosAteAgora }}",
        "unit": "minutes"
      },
      "id": "c91bb824-9777-49a5-8bd4-ed4a438bf8b0",
      "name": "aguarda horas",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1248,
        -1920
      ],
      "webhookId": "2b644b7e-84d6-417d-a264-c7bd2d6365c1"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens que chegam no n√≥.\nconst items = $input.all();\n\n// Array para armazenar os resultados\nconst resultados = [];\n\n// Itera sobre cada item que chega ao n√≥\nfor (const item of items) {\n  try {\n    // 1. EXTRA√á√ÉO DOS INPUTS\n    const minutagemEnvioStr = item.json.minutagem_envio || '0';\n    const horarioEnvioStr = item.json.horario_envio || '0';\n    const horarioEventoStr = item.json.HorarioEvento;\n\n    if (!horarioEventoStr) {\n      item.json.erro = 'O campo HorarioEvento est√° vazio.';\n      resultados.push({ json: item.json });\n      continue;\n    }\n\n    const minutosASubtrair = parseInt(minutagemEnvioStr, 10);\n    const horasASubtrair = parseInt(horarioEnvioStr, 10);\n\n    // 2. C√ÅLCULO 100% MATEM√ÅTICO E SEGURO\n    // Convertemos tudo para n√∫meros (milissegundos) para fugir dos problemas do objeto Date.\n    const totalMinutosASubtrair = (horasASubtrair * 60) + minutosASubtrair;\n    const msASubtrair = totalMinutosASubtrair * 60 * 1000;\n\n    // Usamos new Date() UMA VEZ para pegar o timestamp UTC e nunca mais.\n    const timestampOriginalUTC = new Date(horarioEventoStr).getTime();\n    const timestampCalculadoUTC = timestampOriginalUTC - msASubtrair;\n\n    // 3. FORMATA√á√ÉO MATEM√ÅTICA E SEGURA\n    // Para formatar a data de volta no fuso original, N√ÉO criamos um novo Date.\n    // Primeiro, pegamos o offset do fuso original em milissegundos.\n    const tzMatch = horarioEventoStr.match(/([+-])(\\d{2}):(\\d{2})|Z$/);\n    let offsetMs = 0;\n    let fusoHorarioOriginalStr = 'Z';\n    if (tzMatch && tzMatch[0] !== 'Z') {\n      fusoHorarioOriginalStr = tzMatch[0];\n      const sinal = tzMatch[1] === '+' ? 1 : -1;\n      const horasOffset = parseInt(tzMatch[2], 10);\n      const minutosOffset = parseInt(tzMatch[3], 10);\n      offsetMs = sinal * (horasOffset * 3600 + minutosOffset * 60) * 1000;\n    }\n    \n    // Criamos um objeto Date a partir do timestamp UTC final.\n    // Este objeto servir√° apenas para nos dar os componentes da data em UTC.\n    const dataFinalUTC = new Date(timestampCalculadoUTC);\n\n    // Agora, para obter a hora local correta (ex: no fuso -03:00),\n    // aplicamos o offset ao timestamp UTC.\n    const dataParaDisplay = new Date(timestampCalculadoUTC + offsetMs);\n    \n    const ano = dataParaDisplay.getUTCFullYear();\n    const mes = String(dataParaDisplay.getUTCMonth() + 1).padStart(2, '0');\n    const dia = String(dataParaDisplay.getUTCDate()).padStart(2, '0');\n    const hora = String(dataParaDisplay.getUTCHours()).padStart(2, '0');\n    const minuto = String(dataParaDisplay.getUTCMinutes()).padStart(2, '0');\n    const segundo = String(dataParaDisplay.getUTCSeconds()).padStart(2, '0');\n    \n    const dataFormatada = `${ano}-${mes}-${dia}T${hora}:${minuto}:${segundo}${fusoHorarioOriginalStr}`;\n\n    // 4. C√ÅLCULO DA DIST√ÇNCIA\n    const agoraMs = new Date().getTime();\n    const diffEmMs = timestampCalculadoUTC - agoraMs;\n    const diffEmMinutos = diffEmMs / 60000;\n\n    let distanciaFinal;\n    if (diffEmMinutos < 0) {\n      distanciaFinal = \"ja passou\";\n    } else {\n      distanciaFinal = Math.floor(diffEmMinutos);\n    }\n\n    // 5. PREPARA O OUTPUT\n    const resultadoItem = {\n      horarioCalculadoDoEnvio: dataFormatada,\n      distanciaEmMinutosAteAgora: distanciaFinal,\n    };\n    \n    resultados.push({ json: resultadoItem });\n\n  } catch (error) {\n    item.json.erro = error.message;\n    resultados.push({ json: { ...item.json, erro: error.message } });\n  }\n}\n\nreturn resultados;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1568,
        -1920
      ],
      "id": "c05ce737-6e14-44f6-b160-d4f2980e8e69",
      "name": "calcula horas"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.eduardofischborn.com.br/message/sendText/{{ $('campos lembrete').first().json.Instancia }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=55{{ $('campos lembrete').first().json.Whatsapp }}"
            },
            {
              "name": "text",
              "value": "={{ $('formata texto lembrete').first().json.texto_formatado }}"
            },
            {
              "name": "presence",
              "value": "composing"
            },
            {
              "name": "linkPreview",
              "value": "={{ false }}"
            },
            {
              "name": "delay",
              "value": "={{ 2500 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7285d8da-3fff-4127-a694-ef5fa637e1c1",
      "name": "envia texto",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -224,
        -1920
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "rPARANITH2QYrjl5",
          "name": "[1] EVOLUTION"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.eduardofischborn.com.br/message/sendMedia/{{ $('campos lembrete').first().json.Instancia }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=55{{ $('campos lembrete').first().json.Whatsapp }}"
            },
            {
              "name": "mediatype",
              "value": "image"
            },
            {
              "name": "media",
              "value": "=https:{{ $('puxa lembrete').first().json.conteudo_etapa }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c80a67b5-5c03-4139-be8d-de61925a0582",
      "name": "envia imagem",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -64,
        -1920
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "rPARANITH2QYrjl5",
          "name": "[1] EVOLUTION"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.eduardofischborn.com.br/message/sendText/{{ $('campos lembrete').first().json.Instancia }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=55{{ $('campos lembrete').first().json.Whatsapp }}"
            },
            {
              "name": "text",
              "value": "={{ $('puxa lembrete').first().json.conteudo_etapa }}"
            },
            {
              "name": "presence",
              "value": "composing"
            },
            {
              "name": "linkPreview",
              "value": "={{ false }}"
            },
            {
              "name": "delay",
              "value": "={{ 2500 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "43d2c6ac-9c40-4d58-8975-a133b4c2eab3",
      "name": "envia audio",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        96,
        -1920
      ],
      "disabled": true
    },
    {
      "parameters": {
        "content": "# LEMBRETES",
        "height": 115,
        "width": 625,
        "color": 5
      },
      "id": "5aa12675-206e-4e47-83f6-d8dbf082e156",
      "name": "Sticky Note29",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1648,
        -2352
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "lembretechatbotsdrkruger",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "8380efff-1950-4808-bdb3-c99fd406273e",
      "name": "wh lembrete",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1568,
        -2096
      ],
      "webhookId": "0869168e-a201-47b3-b9e9-0302f7a8e56b"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "46b9479c-bfbf-4140-b641-d0de67d6b8d2",
              "name": "Instancia",
              "value": "={{ $('wh lembrete').first().json.body.Instancia }}",
              "type": "string"
            },
            {
              "id": "4be1ffb3-e9de-46b8-b308-3a358c0ebfd6",
              "name": "chatbot_sdr_n8n",
              "value": "=https://webhook{{ $('puxa usuario').first().json.servidor }}.{{ $('puxa usuario').first().json.dominio }}/webhook/chatbotsdr{{ $('wh lembrete').first().json.body.Instancia.toLowerCase() }}",
              "type": "string"
            },
            {
              "id": "93788f13-9dcf-4da9-b918-ecde7135e404",
              "name": "Whatsapp",
              "value": "={{ $('wh lembrete').first().json.body.whatsapp }}",
              "type": "string"
            },
            {
              "id": "30c907f2-0ee8-497f-88e6-fb86399d0e53",
              "name": "Data",
              "value": "=",
              "type": "string"
            },
            {
              "id": "ad63f00e-5a95-4324-99fa-aae2177f6a3b",
              "name": "Hor√°rio",
              "value": "=",
              "type": "string"
            },
            {
              "id": "e32182f0-ed56-4748-8654-3eaefa2b7ece",
              "name": "HorarioEvento",
              "value": "={{ $('wh lembrete').first().json.body.horario_evento }}",
              "type": "string"
            },
            {
              "id": "bf2a2603-aba8-41da-8b8f-141797ae395e",
              "name": "TelefoneAvisos",
              "value": "={{ $('wh lembrete').first().json.body.TelefoneAvisos }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3f5f74af-d3c6-4d74-b60e-e242a103a59b",
      "name": "campos lembrete",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -912,
        -2096
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('campos lembrete').first().json.Instancia.toLowerCase() }}_sdr_leads",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $('campos lembrete').first().json.Whatsapp }}"
            }
          ]
        }
      },
      "id": "46b96748-b2d0-40c7-aeed-afd35d8a681b",
      "name": "puxa lead lembrete",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -560,
        -2096
      ],
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Recebe o valor de 'ultimo_fup'\nlet ultimoFup = $input.item.json.ultimo_lembrete;\n\n// Converte o valor para um n√∫mero inteiro.\n// Se 'ultimoFup' for null, 0 ou uma string n√£o num√©rica, parseInt resultar√° em NaN (Not-a-Number).\n// O operador '|| 0' garante que, se o resultado for NaN, ele ser√° substitu√≠do por 0.\nlet numero = parseInt(ultimoFup) || 0;\n\n// Soma 1 ao n√∫mero\nlet proximoNumero = numero + 1;\n\n// Retorna o resultado\nreturn { proximo_lembrete: proximoNumero };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -400,
        -2096
      ],
      "id": "b0d76acf-46b1-49d5-89b0-60f75534ab72",
      "name": "numero proximo lembrete"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "lembretes",
        "filters": {
          "conditions": [
            {
              "keyName": "cliente",
              "keyValue": "={{ $('campos lembrete').first().json.Instancia }}"
            },
            {
              "keyName": "ordem",
              "keyValue": "={{ $('numero proximo lembrete').first().json.proximo_lembrete}}"
            },
            {
              "keyName": "workflow_id",
              "keyValue": "=fluxo1"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -240,
        -2096
      ],
      "id": "9ddb9bed-6482-4502-8e71-caae3bedd073",
      "name": "puxa lembrete",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://webhook{{ $('puxa usuario').first().json.servidor }}.{{ $('puxa usuario').first().json.dominio }}/webhook/lembretechatbotsdr{{ $('campos lembrete').first().json.Instancia.toLowerCase() }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "Instancia",
              "value": "={{ $('campos lembrete').first().json.Instancia }}"
            },
            {
              "name": "whatsapp",
              "value": "={{ $('campos lembrete').first().json.Whatsapp }}"
            },
            {
              "name": "horario_evento",
              "value": "={{ $('campos lembrete').first().json.HorarioEvento }}"
            },
            {
              "name": "TelefoneAvisos",
              "value": "={{ $('campos lembrete').first().json.TelefoneAvisos }}"
            },
            {
              "name": "execution",
              "value": "={{$execution.id}}"
            },
            {
              "name": "status",
              "value": "={{ $('wh lembrete').first().json.body.status }}"
            }
          ]
        },
        "options": {}
      },
      "id": "e6c3b749-7158-4d93-a903-4b2fbafa08c0",
      "name": "proximo lembrete",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        432,
        -1920
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bb5a5a03-2578-4d3a-8ea4-f25c00ecf3c1",
              "name": "minutagem_envio",
              "value": "={{ $('puxa lembrete').first().json.minutagem_envio }}",
              "type": "string"
            },
            {
              "id": "29057534-6631-4fc3-92cf-fafa956fff3b",
              "name": "horario_envio",
              "value": "={{ $('puxa lembrete').first().json.horario_envio }}",
              "type": "string"
            },
            {
              "id": "399f8b8f-f0dd-47e9-8b38-6962084b5ea2",
              "name": "HorarioEvento",
              "value": "={{ $('campos lembrete').first().json.HorarioEvento }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        256,
        -2096
      ],
      "id": "3d5126b4-89b1-4735-99c6-1f167f259daf",
      "name": "dados calculo lembrete"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "f48f02a5-949c-4d8b-aa97-be528434b299",
              "leftValue": "={{ $json.distanciaEmMinutosAteAgora.toString() }}",
              "rightValue": "ja passou",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "418596e4-07e1-4ab1-a96a-b3c3131ab9a4",
      "name": "verifica lembrete",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1408,
        -1920
      ]
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  const horarioCompleto = item.json.HorarioEvento; // \"2025-10-27T13:00:00-03:00\"\n\n  // pega s√≥ a parte HH:MM direto da string, ignorando timezone/convers√£o\n  const horas = horarioCompleto.substring(11, 16); // \"13:00\"\n\n  // pega dia e m√™s direto tamb√©m\n  const dia = horarioCompleto.substring(8, 10);    // \"27\"\n  const mes = horarioCompleto.substring(5, 7);     // \"10\"\n\n  item.json.horas = horas;\n  item.json.data = `${dia}/${mes}`;\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -736,
        -2096
      ],
      "id": "3e631510-d416-42ce-8c78-3ec867ce48c8",
      "name": "separa horas data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "17b3d440-1dfc-40c7-8984-849c96523e63",
              "name": "nome",
              "value": "={{ $('puxa lead lembrete').first().json.Nome }}",
              "type": "string"
            },
            {
              "id": "ef3b1384-3d99-47d2-8636-4c2f2ccbc774",
              "name": "horas",
              "value": "={{ $('separa horas data').first().json.horas }}",
              "type": "string"
            },
            {
              "id": "d8abaf5a-5338-43cf-9000-9beeee122bca",
              "name": "data",
              "value": "={{ $('separa horas data').first().json.data }}",
              "type": "string"
            },
            {
              "id": "d4f066a2-3557-4e11-aec5-9df63e657e5b",
              "name": "texto",
              "value": "={{ $('puxa lembrete').first().json.conteudo_etapa }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -64,
        -2096
      ],
      "id": "44e7f4b6-cc73-492d-ab62-39d5c5398203",
      "name": "dados msg"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens que chegam no n√≥\nconst items = $input.all();\n\n// Itera sobre cada item recebido\nfor (const item of items) {\n  // Pega os dados do JSON de cada item\n  const nome = item.json.nome;\n  const horas = item.json.horas;\n  const data = item.json.data;\n  let textoOriginal = item.json.texto;\n\n  // Verifica se o nome √© nulo ou vazio. Se for, usa \"amigo\".\n  const nomeTratado = nome || 'amigo';\n\n  // Substitui as vari√°veis no texto.\n  // O uso de /<...>/g garante que todas as ocorr√™ncias da vari√°vel sejam substitu√≠das.\n  const textoFormatado = textoOriginal\n    .replace(/<nome>/g, nomeTratado)\n    .replace(/<horas>/g, horas)\n    .replace(/<data>/g, data);\n\n  // Adiciona o novo texto formatado em um novo campo no item\n  item.json.texto_formatado = textoFormatado;\n}\n\n// Retorna os itens modificados para o pr√≥ximo n√≥ do workflow\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        -2096
      ],
      "id": "91f6a682-0912-4501-91e4-813823561bb8",
      "name": "formata texto lembrete"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "={{ $('campos lembrete').first().json.Instancia.toLowerCase() }}_sdr_leads",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "condition": "eq",
              "keyValue": "={{ $('campos lembrete').first().json.Whatsapp }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "ultimo_lembrete",
              "fieldValue": "={{ $('numero proximo lembrete').first().json.proximo_lembrete }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        256,
        -1920
      ],
      "id": "5eef04d5-aa5f-42b6-8294-6cacddcd4513",
      "name": "atualiza lembrete",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=N¬∫ da execu√ß√£o: {{$execution.id}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1392,
        -2096
      ],
      "id": "09496181-21fb-47d0-b315-68f0d7824cc6",
      "name": "r wh lembrete"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "usuarios",
        "filters": {
          "conditions": [
            {
              "keyName": "cliente",
              "keyValue": "={{ $('wh lembrete').first().json.body.Instancia }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1072,
        -2096
      ],
      "id": "29b5df9d-76bf-473c-828b-4834669c6fdc",
      "name": "puxa usuario",
      "credentials": {
        "supabaseApi": {
          "id": "GwlTqoK8uSLmTW4I",
          "name": "[0]"
        }
      }
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "cliente",
              "value": "={{ $json.body.Instancia }}"
            },
            {
              "key": "whatsapp",
              "value": "={{ $json.body.whatsapp }}"
            },
            {
              "key": "data",
              "value": "={{ $json.body.horario_evento }}"
            },
            {
              "key": "chamada",
              "value": "lembretes"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -1232,
        -2096
      ],
      "id": "86244812-ec19-4551-b04a-1a9b89d4236c",
      "name": "execucao3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "f48f02a5-949c-4d8b-aa97-be528434b299",
              "leftValue": "={{ $('wh lembrete').first().json.body.status }}",
              "rightValue": "={{ $json.status_agendamento }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "71b84deb-d836-4bbc-bc43-3aeef3d24e11",
              "leftValue": "={{ $json.status_agendamento }}",
              "rightValue": "Cancelado",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "544f4310-c524-4ee3-bac9-4092ed2656df",
      "name": "evento cancelado",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -912,
        -1920
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('campos lembrete').first().json.Instancia.toLowerCase() }}_sdr_agendamentos",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $('campos lembrete').first().json.Whatsapp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1088,
        -1920
      ],
      "id": "f74d52b8-6dd1-40d7-a3e7-cba415be7bbb",
      "name": "puxa agendamento",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "content": "## Personalizado",
        "height": 176,
        "width": 192,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1616,
        -2144
      ],
      "typeVersion": 1,
      "id": "075abdfa-773a-4ed4-9928-01f87307d1c1",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "content": "# Vers√£o 1.1.0",
        "height": 80,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        320,
        -1728
      ],
      "typeVersion": 1,
      "id": "82193708-d4f3-4dc3-849b-5f0479e658ce",
      "name": "Sticky Note26"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "482f0bd5-d3e1-45cb-a39f-87dc91a758a9",
              "leftValue": "={{ $('puxa status').first().json.status }}",
              "rightValue": "on",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -576,
        -1920
      ],
      "id": "4e0b7ed3-8dc7-433e-a173-c5656d0b3a30",
      "name": "on off",
      "executeOnce": true
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "={{ $('campos lembrete').first().json.Instancia.toLowerCase() }}_sdr_leads",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $('campos lembrete').first().json.Whatsapp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -752,
        -1920
      ],
      "id": "4ea1b2d7-7703-4300-901c-f847e5892630",
      "name": "puxa status",
      "credentials": {
        "supabaseApi": {
          "id": "ICRwXhZLBgxPMEhm",
          "name": "[1] SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://webhook{{ $('puxa agente').first().json.servidor }}.{{ $('puxa agente').first().json.dominio }}/webhook/notiontaskerromatriz",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "whatsapp",
              "value": "={{ $('tool hub').first().json.body.sessionid }}"
            },
            {
              "name": "cliente",
              "value": "={{ $('tool hub').first().json.body.instancia }}"
            },
            {
              "name": "execution_tools",
              "value": "={{$execution.id}}"
            },
            {
              "name": "execution_chatbot",
              "value": "={{ $('tool hub').first().json.body.execution }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        192,
        -1072
      ],
      "id": "890ccbc2-6fd4-4724-9531-63f26e06a6c8",
      "name": "fluxo erro matriz"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.datacrazy.io/v1/crm/api/crm/flows/webhooks/a8490509-8831-4b28-9c58-8b89b02ac31c/120f847a-c89a-46e2-983a-07cc4539d10f",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"telefone\":\"{{ $json.sessionid }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        192,
        -448
      ],
      "id": "e2a94e13-1d69-4f73-b328-9597238f64fb",
      "name": "HTTP Request PERDIDOS"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.datacrazy.io/v1/crm/api/crm/flows/webhooks/a8490509-8831-4b28-9c58-8b89b02ac31c/8efca8b8-b6f6-429f-97f6-429a5ff07cfc",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"telefone\": \"{{ $('crm').item.json.sessionid }}\"\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        192,
        -272
      ],
      "id": "3994db6f-4fd6-4dee-9f63-72f34da145e4",
      "name": "HTTP Request EM CONTATO"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.datacrazy.io/v1/crm/api/crm/flows/webhooks/a8490509-8831-4b28-9c58-8b89b02ac31c/5b075d1b-dc11-4301-891e-10782933df36",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"telefone\": \"{{ $('crm').item.json.sessionid }}\"\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        192,
        -624
      ],
      "id": "8bf321ce-1ab9-4dbe-9832-156e4ae34970",
      "name": "HTTP Request REUNI√ÉO AGENDADA"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.datacrazy.io/v1/crm/api/crm/flows/webhooks/a8490509-8831-4b28-9c58-8b89b02ac31c/4804ccbb-a967-4390-a956-903f6deaa71b",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer dc_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZTdkZGY5MjBiNmY0ZTA2ZmY2Zjg2ZiIsInRlbmFudElkIjoiYTg0OTA1MDktODgzMS00YjI4LTljNTgtOGI4OWIwMmFjMzFjIiwibmFtZSI6IkxleGEgMiIsImlhdCI6MTc2MDAyNjEwNX0.N-p0EM6rD9UT4OBZP7m_gopQqBUtBMqjI5MKzP4kchc"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"telefone\": \"{{ $('crm').item.json.sessionid }}\",\n  \"Divida\": \"{{ $json.Valor_divida }}\",\n  \"Banco\": \"{{ $json.Banco }}\"\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        528,
        -784
      ],
      "id": "c0889e1b-a61c-41d4-971a-0135873b7671",
      "name": "HTTP Request QUALIFICADO"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *\nFROM {{ $('execucao').item.json.body.instancia.toLowerCase().concat('_sdr_leads') }}\nWHERE whatsapp = '{{ $('execucao').item.json.body.sessionid }}'",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        192,
        -784
      ],
      "id": "e47473de-e274-4232-9e43-d2266fc17687",
      "name": "Pegando os valores",
      "credentials": {
        "postgres": {
          "id": "mldxnwiYT8SHb9yL",
          "name": "[1] POSTGRES"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const entrada = items[0].json;\nlet dadosStr = entrada.dados;\ndadosStr = JSON.parse(dadosStr)\n\nconst banco = dadosStr.divida_banco\nconst divida = dadosStr.valor_divida\n\nreturn [\n  {\n    json: {\n              \"Valor_divida\": divida,\n              \"Banco\": banco\n      \n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        368,
        -784
      ],
      "id": "03faf857-5b94-4b38-b3d4-a00504a127a4",
      "name": "Limpando os valores"
    }
  ],
  "pinData": {
    "criar evento": [
      {
        "json": {
          "headers": {
            "host": "webhook1.lexa-ia.com",
            "user-agent": "axios/1.8.3",
            "content-length": "256",
            "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook1.lexa-ia.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "8cac176a95f8",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "SessionID": "5191539721",
            "Instancia": "LEXA",
            "intervalo_eventos": "60",
            "TelefoneAvisos": "5481590037",
            "FluxoAgendamentos": "https://webhooklexa-ia.com.1/webhook/lembretechatbotsdrlexa",
            "execution": "163887",
            "horario_confirmado_iso": "2025-10-16T15:00:00-03:00"
          },
          "webhookUrl": "https://webhook1.lexa-ia.com/webhook/sdrtoolcriareventolexa",
          "executionMode": "production"
        }
      }
    ],
    "novo evento": [
      {
        "json": {
          "kind": "calendar#event",
          "etag": "\"3519729241268894\"",
          "id": "50tmve6tpa80cj628vu6h3njef",
          "status": "confirmed",
          "htmlLink": "https://www.google.com/calendar/event?eid=NTB0bXZlNnRwYTgwY2o2Mjh2dTZoM25qZWYgNmQ3MDY5ODM0YzVkMTZkMzhjZTNlZTdiNjg2MWUzNWJjYjVkMTVjMmVmMzAzODI3MjIwNWEwNmY5NDgwNDY5ZEBn",
          "created": "2025-10-07T19:17:00.000Z",
          "updated": "2025-10-07T19:17:00.634Z",
          "summary": "teste apagar",
          "creator": {
            "email": "samuelkruger4@gmail.com"
          },
          "organizer": {
            "email": "6d7069834c5d16d38ce3ee7b6861e35bcb5d15c2ef3038272205a06f9480469d@group.calendar.google.com",
            "displayName": "LEXA Atendimento IA",
            "self": true
          },
          "start": {
            "dateTime": "2025-10-10T14:00:00-03:00",
            "timeZone": "America/Sao_Paulo"
          },
          "end": {
            "dateTime": "2025-10-10T15:00:00-03:00",
            "timeZone": "America/Sao_Paulo"
          },
          "iCalUID": "50tmve6tpa80cj628vu6h3njef@google.com",
          "sequence": 0,
          "reminders": {
            "useDefault": true
          },
          "eventType": "default"
        }
      }
    ],
    "cancelar evento": [
      {
        "json": {
          "kind": "calendar#event",
          "etag": "\"3519729349699230\"",
          "id": "50tmve6tpa80cj628vu6h3njef",
          "status": "cancelled",
          "htmlLink": "https://www.google.com/calendar/event?eid=NTB0bXZlNnRwYTgwY2o2Mjh2dTZoM25qZWYgNmQ3MDY5ODM0YzVkMTZkMzhjZTNlZTdiNjg2MWUzNWJjYjVkMTVjMmVmMzAzODI3MjIwNWEwNmY5NDgwNDY5ZEBn",
          "created": "2025-10-07T19:17:00.000Z",
          "updated": "2025-10-07T19:17:54.849Z",
          "summary": "teste apagar",
          "creator": {
            "email": "samuelkruger4@gmail.com"
          },
          "organizer": {
            "email": "6d7069834c5d16d38ce3ee7b6861e35bcb5d15c2ef3038272205a06f9480469d@group.calendar.google.com",
            "displayName": "LEXA Atendimento IA",
            "self": true
          },
          "start": {
            "dateTime": "2025-10-10T14:00:00-03:00",
            "timeZone": "America/Sao_Paulo"
          },
          "end": {
            "dateTime": "2025-10-10T15:00:00-03:00",
            "timeZone": "America/Sao_Paulo"
          },
          "iCalUID": "50tmve6tpa80cj628vu6h3njef@google.com",
          "sequence": 1,
          "reminders": {
            "useDefault": true
          },
          "eventType": "default"
        }
      }
    ],
    "apaga evento": [
      {
        "json": {
          "headers": {
            "host": "webhook1.lexa-ia.com",
            "user-agent": "axios/1.8.3",
            "content-length": "1189",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook1.lexa-ia.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "8cac176a95f8",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "SessionID": "5191539721",
            "Instancia": "LEXA",
            "TelefoneAvisos": "5481590037",
            "FluxoAgendamentos": "https://webhook1.lexa-ia.com/webhook/lembretechatbotsdrlexa",
            "ResumoConversa": "Humano: Nome: \nEmail: \nSessionID: 5191539721\nQ: boa noite, meu nome √© Jo√£o. Estou entrando em contato com voc√™s pra conhecer mais da IA e melhorar meus agendamentos. Minha fonte de aquisi√ß√£o √©¬†tr√°fego¬†pago. Sou eu o respons√°vel pelo meu comercial/atendimento no escrit√≥rio e estou satisfeito com os resultados. Minha principal dificuldade pra vender mais √©¬†falta¬†de¬†leads.¬†Faturo¬†100k/m√™s. Pode agendar uma conversa pra eu ver tudo¬†funcionando.\n\nIA: Jo√£o, para agendarmos a conversa e mostrar como a IA pode acelerar os seus agendamentos, tenho estes dois hor√°rios: segunda-feira, dia 6/10, √†s 11h ou √†s 12h. Qual prefere?\n\nHumano: Nome: \nEmail: \nSessionID: 5191539721\nQ: dia 6/10, √†s 11h\n\nIA: Excelente escolha, Jo√£o! Confirmado para dia 6 de outubro, √†s 11h. Nossa equipe vai entrar em contato para relembrar do compromisso. Aproveitando, tem algum ponto espec√≠fico sobre o uso da IA no comercial que voc√™ gostaria que a gente aprofunde na reuni√£o?",
            "execution": "163424"
          },
          "webhookUrl": "https://webhook1.lexa-ia.com/webhook/sdrtoolapagareventolexa",
          "executionMode": "production"
        }
      }
    ],
    "zapsign wh": [
      {
        "json": {
          "headers": {
            "host": "webhook1.lexa-ia.com",
            "user-agent": "python-urllib3/1.26.18",
            "content-length": "3788",
            "accept-encoding": "identity",
            "content-type": "application/json",
            "x-forwarded-for": "44.196.128.113",
            "x-forwarded-host": "webhook1.lexa-ia.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "a7008ed3b33b",
            "x-real-ip": "44.196.128.113"
          },
          "params": {},
          "query": {},
          "body": {
            "sandbox": false,
            "external_id": "",
            "open_id": 731,
            "token": "8de6c623-dd7b-4de9-b02b-f26890f35006",
            "name": "Fernanda Daibert Machado.pdf",
            "folder_path": "/",
            "folder_token": null,
            "status": "signed",
            "rejected_reason": null,
            "lang": "pt-br",
            "original_file": "https://zapsign.s3.amazonaws.com/2025/8/docs/326cc5ae-bef4-4273-8016-91466496b0e7/323c4f89-8a9e-4dd9-ab4e-76a9d3cb2dbc.pdf",
            "signed_file": "https://zapsign.s3.amazonaws.com/2025/8/pdf/30ab333f-e99e-4941-bfdf-1554a105d7f8/5daf7330-c7fe-43d8-a258-b7402fbce09a.pdf",
            "extra_docs": [],
            "created_through": "web",
            "deleted": false,
            "deleted_at": null,
            "signed_file_only_finished": false,
            "disable_signer_emails": false,
            "brand_logo": "",
            "brand_primary_color": "",
            "created_at": "2025-08-13T17:11:37.756795Z",
            "last_update_at": "2025-08-26T15:21:37.145542Z",
            "created_by": {
              "email": "samuel.tramontin@icloud.com"
            },
            "template": null,
            "signers": [
              {
                "external_id": "",
                "sign_url": "https://app.zapsign.com.br/verificar/0b779358-070c-4b7c-bb91-224a15e48652",
                "token": "0b779358-070c-4b7c-bb91-224a15e48652",
                "status": "signed",
                "name": "Fernanda Daibert Machado",
                "lock_name": false,
                "email": "fernanda_machado_@hotmail.com",
                "lock_email": false,
                "hide_email": false,
                "blank_email": false,
                "phone_country": "55",
                "phone_number": "62982538283",
                "lock_phone": false,
                "hide_phone": false,
                "blank_phone": false,
                "times_viewed": 6,
                "last_view_at": "2025-08-26T15:19:36.869982Z",
                "signed_at": "2025-08-26T15:21:33.062967Z",
                "auth_mode": "assinaturaTela-tokenEmail",
                "qualification": "",
                "require_selfie_photo": false,
                "require_document_photo": false,
                "geo_latitude": "-15.805307",
                "geo_longitude": "-47.946120",
                "redirect_link": "",
                "signature_image": "https://zapsign.s3.amazonaws.com/2025/8/files/29ad53af-e48f-47e5-b83b-554a813b6064/cfb71fd2-11c0-468c-8099-799dd2032071.png",
                "visto_image": "",
                "document_photo_url": "",
                "document_verse_photo_url": "",
                "selfie_photo_url": "",
                "selfie_photo_url2": "",
                "send_via": "",
                "resend_attempts": {
                  "whatsapp": 0,
                  "email": 2,
                  "sms": 0
                },
                "cpf": "",
                "cnpj": "",
                "send_automatic_whatsapp_signed_file": false,
                "liveness_photo_url": "",
                "selfie_validation_type": "none",
                "ip": "177.235.191.170",
                "delegator": null,
                "signature_anchor_text": null,
                "rubrica_anchor_text": null
              }
            ],
            "answers": [],
            "auto_reminder": 0,
            "signature_report": null,
            "tsa_country": null,
            "use_timestamp": true,
            "metadata": [],
            "event_type": "doc_signed",
            "signer_who_signed": {
              "external_id": "",
              "sign_url": "https://app.zapsign.com.br/verificar/0b779358-070c-4b7c-bb91-224a15e48652",
              "token": "0b779358-070c-4b7c-bb91-224a15e48652",
              "status": "signed",
              "name": "Fernanda Daibert Machado",
              "lock_name": false,
              "email": "fernanda_machado_@hotmail.com",
              "lock_email": false,
              "hide_email": false,
              "blank_email": false,
              "phone_country": "55",
              "phone_number": "62982538283",
              "lock_phone": false,
              "hide_phone": false,
              "blank_phone": false,
              "times_viewed": 6,
              "last_view_at": "2025-08-26T15:19:36.869982Z",
              "signed_at": "2025-08-26T15:21:33.062967Z",
              "auth_mode": "assinaturaTela-tokenEmail",
              "qualification": "",
              "require_selfie_photo": false,
              "require_document_photo": false,
              "geo_latitude": "-15.805307",
              "geo_longitude": "-47.946120",
              "redirect_link": "",
              "signature_image": "https://zapsign.s3.amazonaws.com/2025/8/files/29ad53af-e48f-47e5-b83b-554a813b6064/cfb71fd2-11c0-468c-8099-799dd2032071.png",
              "visto_image": "",
              "document_photo_url": "",
              "document_verse_photo_url": "",
              "selfie_photo_url": "",
              "selfie_photo_url2": "",
              "send_via": "",
              "resend_attempts": {
                "whatsapp": 0,
                "email": 2,
                "sms": 0
              },
              "cpf": "",
              "cnpj": "",
              "send_automatic_whatsapp_signed_file": null,
              "liveness_photo_url": "",
              "selfie_validation_type": "none",
              "ip": "177.235.191.170",
              "delegator": null,
              "signature_anchor_text": null,
              "rubrica_anchor_text": null
            }
          },
          "webhookUrl": "https://webhook1.lexa-ia.com/webhook/zapsign",
          "executionMode": "production"
        }
      }
    ],
    "gerenciar agenda": [
      {
        "json": {
          "headers": {
            "host": "webhook1.lexa-ia.com",
            "user-agent": "axios/1.8.3",
            "content-length": "657",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook1.lexa-ia.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "8cac176a95f8",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "SessionID": "4184608227",
            "Instancia": "KRUGER",
            "execution": "199443",
            "horarios_agendamentos": "[{\"dia_semana\":1,\"horarios\":[{\"inicio\":9,\"fim\":12},{\"inicio\":13,\"fim\":18}]},{\"dia_semana\":2,\"horarios\":[{\"inicio\":9,\"fim\":12},{\"inicio\":13,\"fim\":18}]},{\"dia_semana\":3,\"horarios\":[{\"inicio\":9,\"fim\":12},{\"inicio\":13,\"fim\":18}]},{\"dia_semana\":4,\"horarios\":[{\"inicio\":9,\"fim\":12},{\"inicio\":13,\"fim\":18}]},{\"dia_semana\":5,\"horarios\":[{\"inicio\":9,\"fim\":12},{\"inicio\":13,\"fim\":18}]}]",
            "tempo_previo_agendamento": "2",
            "duracao_agendamento": "60",
            "data": "vazio",
            "horario": "vazio",
            "tipo_de_busca": "sugerir_iniciais"
          },
          "webhookUrl": "https://webhook1.lexa-ia.com/webhook/sdrtoolagendakruger",
          "executionMode": "production"
        }
      }
    ],
    "Datacrazy - Desliga IA": [
      {
        "json": {
          "headers": {
            "host": "webhook1.lexa-ia.com",
            "user-agent": "axios/1.6.8",
            "content-length": "72",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "34.39.250.35",
            "x-forwarded-host": "webhook1.lexa-ia.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "8cac176a95f8",
            "x-real-ip": "34.39.250.35"
          },
          "params": {},
          "query": {},
          "body": {
            "tool": "descarte",
            "sessionid": "555184036335",
            "instancia": "LEXA"
          },
          "webhookUrl": "https://webhook1.lexa-ia.com/webhook/datacrazydesligalead-kruger",
          "executionMode": "production"
        }
      }
    ],
    "wh lembrete": [
      {
        "json": {
          "headers": {
            "host": "webhook1.lexa-ia.com",
            "user-agent": "axios/1.8.3",
            "content-length": "119",
            "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook1.lexa-ia.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "8cac176a95f8",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "horario_evento": "2025-10-06T12:00:00-03:00",
            "whatsapp": "5191539721",
            "Instancia": "LEXA",
            "TelefoneAvisos": "5481590037"
          },
          "webhookUrl": "https://webhook1.lexa-ia.com/webhook/lembretechatbotsdrlexa",
          "executionMode": "production"
        }
      }
    ],
    "tool hub": [
      {
        "json": {
          "headers": {
            "host": "webhook1.lexa-ia.com",
            "user-agent": "axios/1.8.3",
            "content-length": "96",
            "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook1.lexa-ia.com",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "8cac176a95f8",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "tool": "datacrazy_qualificado",
            "sessionid": "5184636271",
            "instancia": "KRUGER",
            "execution": "380473"
          },
          "webhookUrl": "https://webhook1.lexa-ia.com/webhook/chatbottoolskruger",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "criar evento": {
      "main": [
        [
          {
            "node": "execucao1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "criar evento calendar": {
      "main": [
        [
          {
            "node": "preenche tabela agendamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "campos evento": {
      "main": [
        [
          {
            "node": "formata horarios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata horarios": {
      "main": [
        [
          {
            "node": "puxa agenda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa email": {
      "main": [
        [
          {
            "node": "dados lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "email vazio": {
      "main": [
        [
          {
            "node": "criar evento calendar sem invite",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "criar evento calendar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "criar evento calendar sem invite": {
      "main": [
        [
          {
            "node": "preenche tabela agendamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "avisa evento zap": {
      "main": [
        [
          {
            "node": "avisa evento zap1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "data hora": {
      "main": [
        [
          {
            "node": "puxa email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fluxo agendamentos": {
      "main": [
        [
          {
            "node": "r criar evento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata dados pra meta": {
      "main": [
        [
          {
            "node": "mql meta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "r criar evento": {
      "main": [
        [
          {
            "node": "formata dados pra meta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "preenche tabela agendamentos": {
      "main": [
        [
          {
            "node": "avisa evento zap",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "avisa evento zap1": {
      "main": [
        [
          {
            "node": "status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa agendamentos": {
      "main": [
        [
          {
            "node": "reagendar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "reagendar": {
      "main": [
        [
          {
            "node": "update evento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "email vazio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update evento": {
      "main": [
        [
          {
            "node": "atualiza reagendamento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza reagendamento": {
      "main": [
        [
          {
            "node": "avisa evento zap",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados lead": {
      "main": [
        [
          {
            "node": "campos evento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gerenciar agenda": {
      "main": [
        [
          {
            "node": "execucao2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "regras_de_agendamento": {
      "main": [
        [
          {
            "node": "horarios livres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata eventos": {
      "main": [
        [
          {
            "node": "regras_de_agendamento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "horarios livres": {
      "main": [
        [
          {
            "node": "switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "switch": {
      "main": [
        [
          {
            "node": "blocos livres",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "blocos livres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "entenda data": {
      "main": [
        [
          {
            "node": "data para ISO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "data para ISO": {
      "main": [
        [
          {
            "node": "puxa eventos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gpt1": {
      "ai_languageModel": [
        [
          {
            "node": "entenda data",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "string": {
      "main": [
        [
          {
            "node": "escolhe periodo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "resposta inicio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gpt": {
      "ai_languageModel": [
        [
          {
            "node": "escolhe periodo",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "escolhe periodo": {
      "main": [
        [
          {
            "node": "resposta inicio periodo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa eventos": {
      "main": [
        [
          {
            "node": "ordena eventos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "parser": {
      "ai_outputParser": [
        [
          {
            "node": "escolhe periodo",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "data hora calendar": {
      "main": [
        [
          {
            "node": "cria evento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tool hub": {
      "main": [
        [
          {
            "node": "r tool hub",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa lead": {
      "main": [
        [
          {
            "node": "formata telefone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "data hora tool": {
      "main": [
        [
          {
            "node": "puxa agente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "r tool hub": {
      "main": [
        [
          {
            "node": "execucao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa agente": {
      "main": [
        [
          {
            "node": "puxa lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crm": {
      "main": [
        [
          {
            "node": "seleciona tool",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "atualiza crm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao": {
      "main": [
        [
          {
            "node": "data hora tool",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao1": {
      "main": [
        [
          {
            "node": "data hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao2": {
      "main": [
        [
          {
            "node": "entenda data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "blocos livres": {
      "main": [
        [
          {
            "node": "string",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "parser2": {
      "ai_outputParser": [
        [
          {
            "node": "entenda data",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "novo evento": {
      "main": [
        [
          {
            "node": "execucao4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cancelar evento": {
      "main": [
        [
          {
            "node": "execucao5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao4": {
      "main": [
        [
          {
            "node": "data hora calendar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "data hora calendar1": {
      "main": [
        [
          {
            "node": "atualiza evento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao5": {
      "main": [
        [
          {
            "node": "data hora calendar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "apaga evento": {
      "main": [
        [
          {
            "node": "execucao6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao6": {
      "main": [
        [
          {
            "node": "puxa evento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa evento": {
      "main": [
        [
          {
            "node": "cancela evento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cancela evento": {
      "main": [
        [
          {
            "node": "r apaga evento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa agenda": {
      "main": [
        [
          {
            "node": "agenda ocupada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agenda ocupada": {
      "main": [
        [
          {
            "node": "evento ocupado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "puxa agendamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "status": {
      "main": [
        [
          {
            "node": "fluxo agendamentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "campos documento": {
      "main": [
        [
          {
            "node": "atualiza matriz",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "zapsign wh": {
      "main": [
        [
          {
            "node": "formata telefone3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "dados gerais1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ordena eventos": {
      "main": [
        [
          {
            "node": "formata eventos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados gerais": {
      "main": [
        [
          {
            "node": "crm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata telefone": {
      "main": [
        [
          {
            "node": "dados gerais",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "seleciona tool": {
      "main": [
        [
          {
            "node": "descarta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "fluxo erro matriz",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "dados contrato",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pegando os valores",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request REUNI√ÉO AGENDADA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request PERDIDOS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request EM CONTATO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza crm": {
      "main": [
        [
          {
            "node": "atualiza fups",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "zapsign": {
      "main": [
        [
          {
            "node": "aguarda",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "aguarda": {
      "main": [
        [
          {
            "node": "envia link contrato",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "envia link contrato": {
      "main": [
        [
          {
            "node": "avisa envio contrato",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "campos contrato": {
      "main": [
        [
          {
            "node": "zapsign",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados contrato": {
      "main": [
        [
          {
            "node": "campos contrato",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "neg√≥cios do lead1": {
      "main": [
        [
          {
            "node": "puxa dados neg√≥cio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa dados neg√≥cio1": {
      "main": [
        [
          {
            "node": "move card reuni√£o agendada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "neg√≥cios do lead2": {
      "main": [
        [
          {
            "node": "puxa dados neg√≥cio2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Puxa lead2": {
      "main": [
        [
          {
            "node": "neg√≥cios do lead2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa dados neg√≥cio2": {
      "main": [
        [
          {
            "node": "move card perididos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "neg√≥cios do lead3": {
      "main": [
        [
          {
            "node": "puxa dados neg√≥cio3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Puxa lead3": {
      "main": [
        [
          {
            "node": "neg√≥cios do lead3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa dados neg√≥cio3": {
      "main": [
        [
          {
            "node": "move card qualificados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Puxa lead4": {
      "main": [
        [
          {
            "node": "neg√≥cios do lead1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "neg√≥cios do lead4": {
      "main": [
        [
          {
            "node": "puxa dados neg√≥cio4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Puxa lead5": {
      "main": [
        [
          {
            "node": "neg√≥cios do lead4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa dados neg√≥cio4": {
      "main": [
        [
          {
            "node": "move card em contato",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datacrazy - Desliga IA": {
      "main": [
        [
          {
            "node": "execucao7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa rows1": {
      "main": [
        [
          {
            "node": "lead existe supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "lead existe supabase1": {
      "main": [
        [
          {
            "node": "Update a row",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "salva lead off",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "infos dcz": {
      "main": [
        [
          {
            "node": "puxa rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata telefone3": {
      "main": [
        [
          {
            "node": "campos documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata telefone1": {
      "main": [
        [
          {
            "node": "infos dcz",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao7": {
      "main": [
        [
          {
            "node": "data hora1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "data hora1": {
      "main": [
        [
          {
            "node": "formata telefone1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tipo midia": {
      "main": [
        [
          {
            "node": "envia texto",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "envia imagem",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "envia audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "aguarda horas": {
      "main": [
        [
          {
            "node": "puxa agendamento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calcula horas": {
      "main": [
        [
          {
            "node": "verifica lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "envia texto": {
      "main": [
        [
          {
            "node": "atualiza lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "envia imagem": {
      "main": [
        [
          {
            "node": "atualiza lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "envia audio": {
      "main": [
        [
          {
            "node": "atualiza lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "wh lembrete": {
      "main": [
        [
          {
            "node": "r wh lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "campos lembrete": {
      "main": [
        [
          {
            "node": "separa horas data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa lead lembrete": {
      "main": [
        [
          {
            "node": "numero proximo lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "numero proximo lembrete": {
      "main": [
        [
          {
            "node": "puxa lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa lembrete": {
      "main": [
        [
          {
            "node": "dados msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados calculo lembrete": {
      "main": [
        [
          {
            "node": "calcula horas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verifica lembrete": {
      "main": [
        [
          {
            "node": "atualiza lembrete",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "aguarda horas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa horas data": {
      "main": [
        [
          {
            "node": "puxa lead lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados msg": {
      "main": [
        [
          {
            "node": "formata texto lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata texto lembrete": {
      "main": [
        [
          {
            "node": "dados calculo lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza lembrete": {
      "main": [
        [
          {
            "node": "proximo lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "r wh lembrete": {
      "main": [
        [
          {
            "node": "execucao3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa usuario": {
      "main": [
        [
          {
            "node": "campos lembrete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "execucao3": {
      "main": [
        [
          {
            "node": "puxa usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "evento cancelado": {
      "main": [
        [
          {
            "node": "puxa status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa agendamento": {
      "main": [
        [
          {
            "node": "evento cancelado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "on off": {
      "main": [
        [
          {
            "node": "tipo midia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa status": {
      "main": [
        [
          {
            "node": "on off",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pegando os valores": {
      "main": [
        [
          {
            "node": "Limpando os valores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpando os valores": {
      "main": [
        [
          {
            "node": "HTTP Request QUALIFICADO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "callerPolicy": "workflowsFromSameOwner",
    "executionOrder": "v0",
    "errorWorkflow": "8HGeEkJdRI01UGR2"
  },
  "versionId": "c2399e49-af8b-4117-9d39-4c890a717479",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c3cf5738819e614e277c0d56c04b8adf7599f9d1cf7b2c414abde335eedf59ed"
  },
  "id": "0yXSYFXCnr8fYRWA",
  "tags": []
}